(()=>{"use strict";class e{constructor(){this.toLoad=0,this.loaded=0,this.isLoaded=!1,this.list={}}load(e){const t=["png"],s=["json"],i=["toml"];return this.toLoad=e.length,new Promise((h=>{e.forEach((e=>{const n=e.split(".").pop()||"";t.includes(n)?this.loadImage(e,h):s.includes(n)?this.loadJson(e,h):i.includes(n)&&this.loadConfig(e,h)}))}))}loadHandler(e){this.loaded+=1,this.loaded===this.toLoad&&(this.loaded=0,this.toLoad=0,e(this),this.isLoaded=!0)}loadImage(e,t){const s=new Image;s.src=e,s.addEventListener("load",(()=>{this.loadHandler(t)}),!1);const i=e.split("/").pop().split(".")[0];i&&(this.list[i]=s)}async loadConfig(e,t){fetch(e).then((e=>e.text())).then((t=>{const s=t.split("\n").reduce(((e,t)=>{const[s,i]=t.trim().split("=");return s&&i?(e[s.trim()]=i.trim(),e):e}),{}),i=e.split("/").pop().split(".")[0];i&&(this.list[i]=s)}))}async loadJson(e,t){try{const s=await fetch(e),i=await s.json();this.loadHandler(t);const h=e.split("/").pop().split(".")[0];this.list[h]=i}catch(e){}}}class t{constructor(e){this.keys={},console.log("Controller created"),window.addEventListener("keydown",(t=>this.handleKeyDown(t,e))),window.addEventListener("keyup",(t=>this.handleKeyUp(t,e)))}handleKeyDown(e,t){switch(this.keys[e.code]=!0,e.code){case"KeyW":e.preventDefault(),t.vel.y=-1;break;case"KeyS":e.preventDefault(),t.vel.y=1;break;case"KeyA":t.vel.x=-1,e.preventDefault();break;case"KeyD":t.vel.x=1,e.preventDefault();break;case"Space":e.preventDefault(),t.fire();break;default:e.preventDefault()}console.log(this.keys)}handleKeyUp(e,t){this.keys[e.code]=!1,delete this.keys[e.code],this.keys.KeyW||this.keys.KeyS||this.keys.KeyA||this.keys.KeyD||(console.log(this.keys),t.vel.reset())}}class s{error(e){console.error(e)}warn(e){console.warn(e)}info(e){console.info("ℹ️ "+e)}debug(e){console.log("📝 "+e)}}class i{constructor(e,t){this.x=e,this.y=t}add(e){return this.x+=e.x,this.y+=e.y,this}sub(e){return this.x-=e.x,this.y-=e.y,this}mul(e){return this.x*=e.x,this.y*=e.y,this}div(e){return this.x/=e.x,this.y/=e.y,this}clone(){return new i(this.x,this.y)}reset(){return this.x=0,this.y=0,this}}class h{constructor(){this.pos=new i(0,0),this.vel=new i(0,0),this.size=new i(8,8),this.rotation=0,this.speed=1}}class n{constructor(){this.health=100,this.exp=0,this.level=1,this.damage=10,this.speed=1,this.defense=1}}class a extends h{constructor(e,t,s=1){super(),this.pos=e,this.vel=t,this.speed=s}update(e){this.pos.add(this.vel.clone().mul(new i(this.speed,this.speed)))}render(e){e.ctx.fillStyle="white",e.ctx.fillRect(this.pos.x,this.pos.y,2,2)}}class o extends h{constructor(){super(),this.stats=new n,this.bullets=[]}fire(){const e=new i(this.pos.x+this.size.x/2,this.pos.y+this.size.y/2),t=new a(e,new i(0,-1),2);this.bullets.push(t)}update(e){this.pos.add(this.vel),this.bullets.forEach((t=>{t.update(e)}))}render(e){e.drawSprite(0,24,16,16,this.pos.x,this.pos.y,16,16),this.bullets.forEach((t=>{t.render(e)})),this.bullets=this.bullets.filter((t=>{if(s=t,i=e.canvas.width,h=e.canvas.height,!(s.pos.x<0||s.pos.x>i||s.pos.y<0||s.pos.y>h))return t;var s,i,h}))}}class r{constructor(){this.logger=new s,this.image=new Image,this.windowSize={width:256,height:240},this.canvas=document.createElement("canvas"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,this.ctx.scale(this.canvas.width/this.windowSize.width,this.canvas.height/this.windowSize.height),document.querySelector("#main").append(this.canvas),this.logger.info("Renderer initialized"),window.addEventListener("resize",(()=>this.resize()))}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.ctx.scale(this.canvas.width/this.windowSize.width,this.canvas.height/this.windowSize.height),this.ctx.imageSmoothingEnabled=!1}drawSprite(e,t,s,i,h,n,a,o){this.ctx.drawImage(this.image,e,t,s,i,h,n,a,o)}drawText(e,t,s){e.split("").forEach(((e,i)=>{this.ctx.drawImage(t,s[e].x,s[e].y,s[e].w,s[e].h,8*i,0,8,8)}))}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}var l;!function(e){e[e.MENU=0]="MENU",e[e.PLAYING=1]="PLAYING",e[e.PAUSED=2]="PAUSED",e[e.GAME_OVER=3]="GAME_OVER",e[e.OPTIONS=4]="OPTIONS",e[e.LOADING=5]="LOADING"}(l||(l={}));(new class{constructor(){this.renderer=new r,this.assetLoader=new e,this.lastTime=0,this.logger=new s,this.logger.info("Game started"),this.player=new o,this.controller=new t(this.player),window.game=this}update(e){const t=e-this.lastTime;this.lastTime=e,this.player.update(t)}render(){this.renderer.clear(),this.renderer.drawText("SPACE SHOOTER GAIDEN V0.1",this.assetLoader.list.spritesheet,this.assetLoader.list.spritesheet_map),this.player.render(this.renderer)}run(){this.logger.info("Game running"),this.assetLoader.load(["assets/spritesheet.png","assets/spritesheet_map.json"]).then((()=>{this.logger.info("Assets loaded"),this.renderer.image=this.assetLoader.list.spritesheet,this.loop()}))}loop(){this.update(performance.now()),this.render(),requestAnimationFrame((()=>this.loop()))}}).run()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FDQUEsT0FDSXZJLEtBQUtvRixPQUFPb0QsWUFBWUMsT0FDeEJ6SSxLQUFLc0YsU0FDTG9ELHVCQUFzQixJQUFNMUksS0FBS3VJLFFBQ3JDLElDaERDRCxLIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3BhY2VzaG9vdGVyZ2FpZGVuLy4vc3JjL2Fzc2V0bG9hZGVyLnRzIiwid2VicGFjazovL3NwYWNlc2hvb3RlcmdhaWRlbi8uL3NyYy9jb250cm9sbGVyLnRzIiwid2VicGFjazovL3NwYWNlc2hvb3RlcmdhaWRlbi8uL3NyYy9sb2dnZXIudHMiLCJ3ZWJwYWNrOi8vc3BhY2VzaG9vdGVyZ2FpZGVuLy4vc3JjL3ZlY3RvcjIudHMiLCJ3ZWJwYWNrOi8vc3BhY2VzaG9vdGVyZ2FpZGVuLy4vc3JjL2dhbWVvYmplY3QudHMiLCJ3ZWJwYWNrOi8vc3BhY2VzaG9vdGVyZ2FpZGVuLy4vc3JjL3BsYXllci50cyIsIndlYnBhY2s6Ly9zcGFjZXNob290ZXJnYWlkZW4vLi9zcmMvdXRpbHMudHMiLCJ3ZWJwYWNrOi8vc3BhY2VzaG9vdGVyZ2FpZGVuLy4vc3JjL3JlbmRlcmVyLnRzIiwid2VicGFjazovL3NwYWNlc2hvb3RlcmdhaWRlbi8uL3NyYy9nYW1lLnRzIiwid2VicGFjazovL3NwYWNlc2hvb3RlcmdhaWRlbi8uL3NyYy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvL0B0cy1ub2NoZWNrXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBc3NldExvYWRlciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMudG9Mb2FkID0gMDtcbiAgICAgICAgdGhpcy5sb2FkZWQgPSAwO1xuICAgICAgICB0aGlzLmlzTG9hZGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMubGlzdCA9IHt9O1xuICAgIH1cbiAgICBsb2FkKGFzc2V0cykge1xuICAgICAgICBjb25zdCBpbWFnZUV4dCA9IFtcInBuZ1wiXTtcbiAgICAgICAgY29uc3QganNvbkV4dCA9IFtcImpzb25cIl07XG4gICAgICAgIGNvbnN0IGNvbmZpZ0V4dCA9IFtcInRvbWxcIl07XG4gICAgICAgIHRoaXMudG9Mb2FkID0gYXNzZXRzLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgICAgICBhc3NldHMuZm9yRWFjaCgoYXNzZXQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBleHRlbnNpb24gPSBhc3NldC5zcGxpdChcIi5cIikucG9wKCkgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICBpZiAoaW1hZ2VFeHQuaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRJbWFnZShhc3NldCwgcmVzb2x2ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGpzb25FeHQuaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRKc29uKGFzc2V0LCByZXNvbHZlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY29uZmlnRXh0LmluY2x1ZGVzKGV4dGVuc2lvbikpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkQ29uZmlnKGFzc2V0LCByZXNvbHZlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGxvYWRIYW5kbGVyKHJlc29sdmUpIHtcbiAgICAgICAgdGhpcy5sb2FkZWQgKz0gMTtcbiAgICAgICAgaWYgKHRoaXMubG9hZGVkID09PSB0aGlzLnRvTG9hZCkge1xuICAgICAgICAgICAgdGhpcy5sb2FkZWQgPSAwO1xuICAgICAgICAgICAgdGhpcy50b0xvYWQgPSAwO1xuICAgICAgICAgICAgcmVzb2x2ZSh0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuaXNMb2FkZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGxvYWRJbWFnZShzcmMsIHJlc29sdmUpIHtcbiAgICAgICAgY29uc3QgaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgaW1hZ2Uuc3JjID0gc3JjO1xuICAgICAgICBpbWFnZS5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxvYWRIYW5kbGVyKHJlc29sdmUpO1xuICAgICAgICB9LCBmYWxzZSk7XG4gICAgICAgIGNvbnN0IG5hbWUgPSBzcmMuc3BsaXQoXCIvXCIpLnBvcCgpLnNwbGl0KFwiLlwiKVswXTtcbiAgICAgICAgaWYgKG5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMubGlzdFtuYW1lXSA9IGltYWdlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIGxvYWRDb25maWcoc3JjLCByZXNvbHZlKSB7XG4gICAgICAgIGZldGNoKHNyYylcbiAgICAgICAgICAgIC50aGVuKChkYXRhKSA9PiBkYXRhLnRleHQoKSlcbiAgICAgICAgICAgIC50aGVuKCh0ZXh0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb25maWcgPSB0ZXh0LnNwbGl0KFwiXFxuXCIpLnJlZHVjZSgob2JqLCBzdHIpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBba2V5LCB2YWx1ZV0gPSBzdHIudHJpbSgpLnNwbGl0KFwiPVwiKTtcbiAgICAgICAgICAgICAgICBpZiAoIWtleSB8fCAhdmFsdWUpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgICAgICAgICAgb2JqW2tleS50cmltKCldID0gdmFsdWUudHJpbSgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgICAgICB9LCB7fSk7XG4gICAgICAgICAgICBjb25zdCBuYW1lID0gc3JjLnNwbGl0KFwiL1wiKS5wb3AoKS5zcGxpdChcIi5cIilbMF07XG4gICAgICAgICAgICBpZiAobmFtZSkge1xuICAgICAgICAgICAgICAgIHRoaXMubGlzdFtuYW1lXSA9IGNvbmZpZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGFzeW5jIGxvYWRKc29uKHNyYywgcmVzb2x2ZSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChzcmMpO1xuICAgICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIHRoaXMubG9hZEhhbmRsZXIocmVzb2x2ZSk7XG4gICAgICAgICAgICBjb25zdCBuYW1lID0gc3JjLnNwbGl0KFwiL1wiKS5wb3AoKS5zcGxpdChcIi5cIilbMF07XG4gICAgICAgICAgICB0aGlzLmxpc3RbbmFtZV0gPSBkYXRhO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikgeyB9XG4gICAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29udHJvbGxlciB7XG4gICAgY29uc3RydWN0b3IocGxheWVyKSB7XG4gICAgICAgIHRoaXMua2V5cyA9IHt9O1xuICAgICAgICBjb25zb2xlLmxvZyhcIkNvbnRyb2xsZXIgY3JlYXRlZFwiKTtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlKSA9PiB0aGlzLmhhbmRsZUtleURvd24oZSwgcGxheWVyKSk7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgKGUpID0+IHRoaXMuaGFuZGxlS2V5VXAoZSwgcGxheWVyKSk7XG4gICAgfVxuICAgIGhhbmRsZUtleURvd24oZSwgcGxheWVyKSB7XG4gICAgICAgIHRoaXMua2V5c1tlLmNvZGVdID0gdHJ1ZTtcbiAgICAgICAgc3dpdGNoIChlLmNvZGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJLZXlXXCI6XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIC8vcGxheWVyLm1vdmUoXCJuXCIpO1xuICAgICAgICAgICAgICAgIHBsYXllci52ZWwueSA9IC0xO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIktleVNcIjpcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgcGxheWVyLnZlbC55ID0gMTtcbiAgICAgICAgICAgICAgICAvL3BsYXllci5tb3ZlKFwic1wiKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJLZXlBXCI6XG4gICAgICAgICAgICAgICAgcGxheWVyLnZlbC54ID0gLTE7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIC8vcGxheWVyLm1vdmUoXCJ3XCIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIktleURcIjpcbiAgICAgICAgICAgICAgICBwbGF5ZXIudmVsLnggPSAxO1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAvL3BsYXllci5tb3ZlKFwiZVwiKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJTcGFjZVwiOlxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBwbGF5ZXIuZmlyZSgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2codGhpcy5rZXlzKTtcbiAgICB9XG4gICAgaGFuZGxlS2V5VXAoZSwgcGxheWVyKSB7XG4gICAgICAgIHRoaXMua2V5c1tlLmNvZGVdID0gZmFsc2U7XG4gICAgICAgIGRlbGV0ZSB0aGlzLmtleXNbZS5jb2RlXTtcbiAgICAgICAgaWYgKCF0aGlzLmtleXNbXCJLZXlXXCJdICYmXG4gICAgICAgICAgICAhdGhpcy5rZXlzW1wiS2V5U1wiXSAmJlxuICAgICAgICAgICAgIXRoaXMua2V5c1tcIktleUFcIl0gJiZcbiAgICAgICAgICAgICF0aGlzLmtleXNbXCJLZXlEXCJdKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmtleXMpO1xuICAgICAgICAgICAgcGxheWVyLnZlbC5yZXNldCgpO1xuICAgICAgICB9XG4gICAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgTG9nZ2VyIHtcbiAgICBlcnJvcihtZXNzYWdlKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IobWVzc2FnZSk7XG4gICAgfVxuICAgIHdhcm4obWVzc2FnZSkge1xuICAgICAgICBjb25zb2xlLndhcm4obWVzc2FnZSk7XG4gICAgfVxuICAgIGluZm8obWVzc2FnZSkge1xuICAgICAgICBjb25zb2xlLmluZm8oXCLihLnvuI8gXCIgKyBtZXNzYWdlKTtcbiAgICB9XG4gICAgZGVidWcobWVzc2FnZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIvCfk50gXCIgKyBtZXNzYWdlKTtcbiAgICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBWZWN0b3IyIHtcbiAgICBjb25zdHJ1Y3Rvcih4LCB5KSB7XG4gICAgICAgIHRoaXMueCA9IHg7XG4gICAgICAgIHRoaXMueSA9IHk7XG4gICAgfVxuICAgIGFkZCh2KSB7XG4gICAgICAgIHRoaXMueCArPSB2Lng7XG4gICAgICAgIHRoaXMueSArPSB2Lnk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBzdWIodikge1xuICAgICAgICB0aGlzLnggLT0gdi54O1xuICAgICAgICB0aGlzLnkgLT0gdi55O1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgbXVsKHYpIHtcbiAgICAgICAgdGhpcy54ICo9IHYueDtcbiAgICAgICAgdGhpcy55ICo9IHYueTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIGRpdih2KSB7XG4gICAgICAgIHRoaXMueCAvPSB2Lng7XG4gICAgICAgIHRoaXMueSAvPSB2Lnk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBjbG9uZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKHRoaXMueCwgdGhpcy55KTtcbiAgICB9XG4gICAgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMueCA9IDA7XG4gICAgICAgIHRoaXMueSA9IDA7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbn1cbiIsImltcG9ydCBWZWN0b3IyIGZyb20gXCIuL3ZlY3RvcjJcIjtcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbWVPYmplY3Qge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnBvcyA9IG5ldyBWZWN0b3IyKDAsIDApO1xuICAgICAgICB0aGlzLnZlbCA9IG5ldyBWZWN0b3IyKDAsIDApO1xuICAgICAgICB0aGlzLnNpemUgPSBuZXcgVmVjdG9yMig4LCA4KTtcbiAgICAgICAgdGhpcy5yb3RhdGlvbiA9IDA7XG4gICAgICAgIHRoaXMuc3BlZWQgPSAxO1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBTdGF0cyB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuaGVhbHRoID0gMTAwO1xuICAgICAgICB0aGlzLmV4cCA9IDA7XG4gICAgICAgIHRoaXMubGV2ZWwgPSAxO1xuICAgICAgICB0aGlzLmRhbWFnZSA9IDEwO1xuICAgICAgICB0aGlzLnNwZWVkID0gMTtcbiAgICAgICAgdGhpcy5kZWZlbnNlID0gMTtcbiAgICB9XG59XG4iLCJpbXBvcnQgR2FtZU9iamVjdCwgeyBTdGF0cyB9IGZyb20gXCIuL2dhbWVvYmplY3RcIjtcbmltcG9ydCB7IGlzT3V0T2ZTY3JlZW4gfSBmcm9tIFwiLi91dGlsc1wiO1xuaW1wb3J0IFZlY3RvcjIgZnJvbSBcIi4vdmVjdG9yMlwiO1xuZXhwb3J0IGNsYXNzIEJ1bGxldCBleHRlbmRzIEdhbWVPYmplY3Qge1xuICAgIGNvbnN0cnVjdG9yKHBvcywgdmVsLCBzcGVlZCA9IDEpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5wb3MgPSBwb3M7XG4gICAgICAgIHRoaXMudmVsID0gdmVsO1xuICAgICAgICB0aGlzLnNwZWVkID0gc3BlZWQ7XG4gICAgfVxuICAgIHVwZGF0ZShkdCkge1xuICAgICAgICB0aGlzLnBvcy5hZGQodGhpcy52ZWwuY2xvbmUoKS5tdWwobmV3IFZlY3RvcjIodGhpcy5zcGVlZCwgdGhpcy5zcGVlZCkpKTtcbiAgICB9XG4gICAgcmVuZGVyKHJlbmRlcmVyKSB7XG4gICAgICAgIHJlbmRlcmVyLmN0eC5maWxsU3R5bGUgPSBcIndoaXRlXCI7XG4gICAgICAgIHJlbmRlcmVyLmN0eC5maWxsUmVjdCh0aGlzLnBvcy54LCB0aGlzLnBvcy55LCAyLCAyKTtcbiAgICB9XG59XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQbGF5ZXIgZXh0ZW5kcyBHYW1lT2JqZWN0IHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5zdGF0cyA9IG5ldyBTdGF0cygpO1xuICAgICAgICB0aGlzLmJ1bGxldHMgPSBbXTtcbiAgICB9XG4gICAgZmlyZSgpIHtcbiAgICAgICAgY29uc3QgY2VudGVyZWRQb3MgPSBuZXcgVmVjdG9yMih0aGlzLnBvcy54ICsgdGhpcy5zaXplLnggLyAyLCB0aGlzLnBvcy55ICsgdGhpcy5zaXplLnkgLyAyKTtcbiAgICAgICAgY29uc3QgYnVsbGV0ID0gbmV3IEJ1bGxldChjZW50ZXJlZFBvcywgbmV3IFZlY3RvcjIoMCwgLTEpLCAyKTtcbiAgICAgICAgdGhpcy5idWxsZXRzLnB1c2goYnVsbGV0KTtcbiAgICB9XG4gICAgdXBkYXRlKGR0KSB7XG4gICAgICAgIHRoaXMucG9zLmFkZCh0aGlzLnZlbCk7XG4gICAgICAgIHRoaXMuYnVsbGV0cy5mb3JFYWNoKChidWxsZXQpID0+IHtcbiAgICAgICAgICAgIGJ1bGxldC51cGRhdGUoZHQpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmVuZGVyKHJlbmRlcmVyKSB7XG4gICAgICAgIHJlbmRlcmVyLmRyYXdTcHJpdGUoMCwgMjQsIDE2LCAxNiwgdGhpcy5wb3MueCwgdGhpcy5wb3MueSwgMTYsIDE2KTtcbiAgICAgICAgdGhpcy5idWxsZXRzLmZvckVhY2goKGJ1bGxldCkgPT4ge1xuICAgICAgICAgICAgYnVsbGV0LnJlbmRlcihyZW5kZXJlcik7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmJ1bGxldHMgPSB0aGlzLmJ1bGxldHMuZmlsdGVyKChidWxsZXQpID0+IHtcbiAgICAgICAgICAgIGlmICghaXNPdXRPZlNjcmVlbihidWxsZXQsIHJlbmRlcmVyLmNhbnZhcy53aWR0aCwgcmVuZGVyZXIuY2FudmFzLmhlaWdodCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYnVsbGV0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59XG4iLCJleHBvcnQgZnVuY3Rpb24gaXNDb2xsaWRlKGEsIGIpIHtcbiAgICByZXR1cm4gKGEucG9zLnggPCBiLnBvcy54ICsgYi5zaXplLnggJiZcbiAgICAgICAgYS5wb3MueCArIGEuc2l6ZS54ID4gYi5wb3MueCAmJlxuICAgICAgICBhLnBvcy55IDwgYi5wb3MueSArIGIuc2l6ZS55ICYmXG4gICAgICAgIGEucG9zLnkgKyBhLnNpemUueSA+IGIucG9zLnkpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGlzT3V0T2ZTY3JlZW4ob2JqLCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgcmV0dXJuIChvYmoucG9zLnggPCAwIHx8XG4gICAgICAgIG9iai5wb3MueCA+IHdpZHRoIHx8XG4gICAgICAgIG9iai5wb3MueSA8IDAgfHxcbiAgICAgICAgb2JqLnBvcy55ID4gaGVpZ2h0KTtcbn1cbiIsImltcG9ydCBMb2dnZXIgZnJvbSBcIi4vbG9nZ2VyXCI7XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSZW5kZXJlciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyID0gbmV3IExvZ2dlcigpO1xuICAgICAgICB0aGlzLmltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgICAgIHRoaXMud2luZG93U2l6ZSA9IHtcbiAgICAgICAgICAgIHdpZHRoOiAyNTYsXG4gICAgICAgICAgICBoZWlnaHQ6IDI0MCxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5jYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAgICAgICB0aGlzLmNhbnZhcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgICAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgICAgIHRoaXMuY3R4ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgICB0aGlzLmN0eC5pbWFnZVNtb290aGluZ0VuYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jdHguc2NhbGUodGhpcy5jYW52YXMud2lkdGggLyB0aGlzLndpbmRvd1NpemUud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCAvIHRoaXMud2luZG93U2l6ZS5oZWlnaHQpO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21haW5cIikuYXBwZW5kKHRoaXMuY2FudmFzKTtcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhcIlJlbmRlcmVyIGluaXRpYWxpemVkXCIpO1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCAoKSA9PiB0aGlzLnJlc2l6ZSgpKTtcbiAgICB9XG4gICAgcmVzaXplKCkge1xuICAgICAgICB0aGlzLmNhbnZhcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgICAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgICAgIHRoaXMuY3R4LnNjYWxlKHRoaXMuY2FudmFzLndpZHRoIC8gdGhpcy53aW5kb3dTaXplLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQgLyB0aGlzLndpbmRvd1NpemUuaGVpZ2h0KTtcbiAgICAgICAgdGhpcy5jdHguaW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gZmFsc2U7XG4gICAgfVxuICAgIGRyYXdTcHJpdGUodGlsZVgsIHRpbGVZLCB3LCBoLCB4LCB5LCBzaXplWCwgc2l6ZVkpIHtcbiAgICAgICAgdGhpcy5jdHguZHJhd0ltYWdlKHRoaXMuaW1hZ2UsIHRpbGVYLCB0aWxlWSwgdywgaCwgeCwgeSwgc2l6ZVgsIHNpemVZKTtcbiAgICB9XG4gICAgZHJhd1RleHQodGV4dCwgc3ByaXRlU2hlZXQsIHNwcml0ZVNoZWV0TWFwKSB7XG4gICAgICAgIHRleHQuc3BsaXQoXCJcIikuZm9yRWFjaCgoY2hhciwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY3R4LmRyYXdJbWFnZShzcHJpdGVTaGVldCwgc3ByaXRlU2hlZXRNYXBbY2hhcl0ueCwgc3ByaXRlU2hlZXRNYXBbY2hhcl0ueSwgc3ByaXRlU2hlZXRNYXBbY2hhcl0udywgc3ByaXRlU2hlZXRNYXBbY2hhcl0uaCwgaW5kZXggKiA4LCAwLCA4LCA4KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNsZWFyKCkge1xuICAgICAgICB0aGlzLmN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCk7XG4gICAgfVxufVxuIiwiaW1wb3J0IEFzc2V0TG9hZGVyIGZyb20gXCIuL2Fzc2V0bG9hZGVyXCI7XG5pbXBvcnQgQ29udHJvbGxlciBmcm9tIFwiLi9jb250cm9sbGVyXCI7XG5pbXBvcnQgTG9nZ2VyIGZyb20gXCIuL2xvZ2dlclwiO1xuaW1wb3J0IFBsYXllciBmcm9tIFwiLi9wbGF5ZXJcIjtcbmltcG9ydCBSZW5kZXJlciBmcm9tIFwiLi9yZW5kZXJlclwiO1xudmFyIEdhbWVTdGF0ZTtcbihmdW5jdGlvbiAoR2FtZVN0YXRlKSB7XG4gICAgR2FtZVN0YXRlW0dhbWVTdGF0ZVtcIk1FTlVcIl0gPSAwXSA9IFwiTUVOVVwiO1xuICAgIEdhbWVTdGF0ZVtHYW1lU3RhdGVbXCJQTEFZSU5HXCJdID0gMV0gPSBcIlBMQVlJTkdcIjtcbiAgICBHYW1lU3RhdGVbR2FtZVN0YXRlW1wiUEFVU0VEXCJdID0gMl0gPSBcIlBBVVNFRFwiO1xuICAgIEdhbWVTdGF0ZVtHYW1lU3RhdGVbXCJHQU1FX09WRVJcIl0gPSAzXSA9IFwiR0FNRV9PVkVSXCI7XG4gICAgR2FtZVN0YXRlW0dhbWVTdGF0ZVtcIk9QVElPTlNcIl0gPSA0XSA9IFwiT1BUSU9OU1wiO1xuICAgIEdhbWVTdGF0ZVtHYW1lU3RhdGVbXCJMT0FESU5HXCJdID0gNV0gPSBcIkxPQURJTkdcIjtcbn0pKEdhbWVTdGF0ZSB8fCAoR2FtZVN0YXRlID0ge30pKTtcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbWUge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnJlbmRlcmVyID0gbmV3IFJlbmRlcmVyKCk7XG4gICAgICAgIHRoaXMuYXNzZXRMb2FkZXIgPSBuZXcgQXNzZXRMb2FkZXIoKTtcbiAgICAgICAgdGhpcy5sYXN0VGltZSA9IDA7XG4gICAgICAgIHRoaXMubG9nZ2VyID0gbmV3IExvZ2dlcigpO1xuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKFwiR2FtZSBzdGFydGVkXCIpO1xuICAgICAgICB0aGlzLnBsYXllciA9IG5ldyBQbGF5ZXIoKTtcbiAgICAgICAgdGhpcy5jb250cm9sbGVyID0gbmV3IENvbnRyb2xsZXIodGhpcy5wbGF5ZXIpO1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIHdpbmRvd1tcImdhbWVcIl0gPSB0aGlzO1xuICAgIH1cbiAgICB1cGRhdGUodHMpIHtcbiAgICAgICAgY29uc3QgZHQgPSB0cyAtIHRoaXMubGFzdFRpbWU7XG4gICAgICAgIHRoaXMubGFzdFRpbWUgPSB0cztcbiAgICAgICAgdGhpcy5wbGF5ZXIudXBkYXRlKGR0KTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLmNsZWFyKCk7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuZHJhd1RleHQoXCJTUEFDRSBTSE9PVEVSIEdBSURFTiBWMC4xXCIsIHRoaXMuYXNzZXRMb2FkZXIubGlzdFtcInNwcml0ZXNoZWV0XCJdLCB0aGlzLmFzc2V0TG9hZGVyLmxpc3RbXCJzcHJpdGVzaGVldF9tYXBcIl0pO1xuICAgICAgICB0aGlzLnBsYXllci5yZW5kZXIodGhpcy5yZW5kZXJlcik7XG4gICAgfVxuICAgIHJ1bigpIHtcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhcIkdhbWUgcnVubmluZ1wiKTtcbiAgICAgICAgdGhpcy5hc3NldExvYWRlclxuICAgICAgICAgICAgLmxvYWQoW1wiYXNzZXRzL3Nwcml0ZXNoZWV0LnBuZ1wiLCBcImFzc2V0cy9zcHJpdGVzaGVldF9tYXAuanNvblwiXSlcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmluZm8oXCJBc3NldHMgbG9hZGVkXCIpO1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5pbWFnZSA9IHRoaXMuYXNzZXRMb2FkZXIubGlzdFtcInNwcml0ZXNoZWV0XCJdO1xuICAgICAgICAgICAgdGhpcy5sb29wKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBsb29wKCkge1xuICAgICAgICB0aGlzLnVwZGF0ZShwZXJmb3JtYW5jZS5ub3coKSk7XG4gICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLmxvb3AoKSk7XG4gICAgfVxufVxuIiwiaW1wb3J0IEdhbWUgZnJvbSBcIi4vZ2FtZVwiO1xuY29uc3QgZ2FtZSA9IG5ldyBHYW1lKCk7XG5nYW1lLnJ1bigpO1xuIl0sIm5hbWVzIjpbIkFzc2V0TG9hZGVyIiwiY29uc3RydWN0b3IiLCJ0aGlzIiwidG9Mb2FkIiwibG9hZGVkIiwiaXNMb2FkZWQiLCJsaXN0IiwibG9hZCIsImFzc2V0cyIsImltYWdlRXh0IiwianNvbkV4dCIsImNvbmZpZ0V4dCIsImxlbmd0aCIsIlByb21pc2UiLCJyZXNvbHZlIiwiZm9yRWFjaCIsImFzc2V0IiwiZXh0ZW5zaW9uIiwic3BsaXQiLCJwb3AiLCJpbmNsdWRlcyIsImxvYWRJbWFnZSIsImxvYWRKc29uIiwibG9hZENvbmZpZyIsImxvYWRIYW5kbGVyIiwic3JjIiwiaW1hZ2UiLCJJbWFnZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJuYW1lIiwiYXN5bmMiLCJmZXRjaCIsInRoZW4iLCJkYXRhIiwidGV4dCIsImNvbmZpZyIsInJlZHVjZSIsIm9iaiIsInN0ciIsImtleSIsInZhbHVlIiwidHJpbSIsInJlc3BvbnNlIiwianNvbiIsImVycm9yIiwiQ29udHJvbGxlciIsInBsYXllciIsImtleXMiLCJjb25zb2xlIiwibG9nIiwid2luZG93IiwiZSIsImhhbmRsZUtleURvd24iLCJoYW5kbGVLZXlVcCIsImNvZGUiLCJwcmV2ZW50RGVmYXVsdCIsInZlbCIsInkiLCJ4IiwiZmlyZSIsInJlc2V0IiwiTG9nZ2VyIiwibWVzc2FnZSIsIndhcm4iLCJpbmZvIiwiZGVidWciLCJWZWN0b3IyIiwiYWRkIiwidiIsInN1YiIsIm11bCIsImRpdiIsImNsb25lIiwiR2FtZU9iamVjdCIsInBvcyIsInNpemUiLCJyb3RhdGlvbiIsInNwZWVkIiwiU3RhdHMiLCJoZWFsdGgiLCJleHAiLCJsZXZlbCIsImRhbWFnZSIsImRlZmVuc2UiLCJCdWxsZXQiLCJzdXBlciIsInVwZGF0ZSIsImR0IiwicmVuZGVyIiwicmVuZGVyZXIiLCJjdHgiLCJmaWxsU3R5bGUiLCJmaWxsUmVjdCIsIlBsYXllciIsInN0YXRzIiwiYnVsbGV0cyIsImNlbnRlcmVkUG9zIiwiYnVsbGV0IiwicHVzaCIsImRyYXdTcHJpdGUiLCJmaWx0ZXIiLCJ3aWR0aCIsImNhbnZhcyIsImhlaWdodCIsIlJlbmRlcmVyIiwibG9nZ2VyIiwid2luZG93U2l6ZSIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImlubmVyV2lkdGgiLCJpbm5lckhlaWdodCIsImdldENvbnRleHQiLCJpbWFnZVNtb290aGluZ0VuYWJsZWQiLCJzY2FsZSIsInF1ZXJ5U2VsZWN0b3IiLCJhcHBlbmQiLCJyZXNpemUiLCJ0aWxlWCIsInRpbGVZIiwidyIsImgiLCJzaXplWCIsInNpemVZIiwiZHJhd0ltYWdlIiwiZHJhd1RleHQiLCJzcHJpdGVTaGVldCIsInNwcml0ZVNoZWV0TWFwIiwiY2hhciIsImluZGV4IiwiY2xlYXIiLCJjbGVhclJlY3QiLCJHYW1lU3RhdGUiLCJhc3NldExvYWRlciIsImxhc3RUaW1lIiwiY29udHJvbGxlciIsInRzIiwicnVuIiwibG9vcCIsInBlcmZvcm1hbmNlIiwibm93IiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIl0sInNvdXJjZVJvb3QiOiIifQ==