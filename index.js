(()=>{"use strict";class t{constructor(){this.toLoad=0,this.loaded=0,this.isLoaded=!1,this.list={}}load(t){const e=["png"],s=["json"],i=["toml"];return this.toLoad=t.length,new Promise((h=>{t.forEach((t=>{const n=t.split(".").pop()||"";e.includes(n)?this.loadImage(t,h):s.includes(n)?this.loadJson(t,h):i.includes(n)&&this.loadConfig(t,h)}))}))}loadHandler(t){this.loaded+=1,this.loaded===this.toLoad&&(this.loaded=0,this.toLoad=0,t(this),this.isLoaded=!0)}loadImage(t,e){const s=new Image;s.src=t,s.addEventListener("load",(()=>{this.loadHandler(e)}),!1);const i=t.split("/").pop().split(".")[0];i&&(this.list[i]=s)}async loadConfig(t,e){fetch(t).then((t=>t.text())).then((e=>{const s=e.split("\n").reduce(((t,e)=>{const[s,i]=e.trim().split("=");return s&&i?(t[s.trim()]=i.trim(),t):t}),{}),i=t.split("/").pop().split(".")[0];i&&(this.list[i]=s)}))}async loadJson(t,e){try{const s=await fetch(t),i=await s.json();this.loadHandler(e);const h=t.split("/").pop().split(".")[0];this.list[h]=i}catch(t){}}}const e=["KeyW","KeyA","KeyS","KeyD","Space","Escape"];class s{constructor(t){this.keys={},console.log("Controller created"),this.game=t,this.player=t.player,window.addEventListener("keydown",(t=>this.handleKeyDown(t))),window.addEventListener("keyup",(t=>this.handleKeyUp(t)))}handleKeyDown(t){e.includes(t.code)&&(t.preventDefault(),this.keys[t.code]=1)}handleKeyUp(t){this.keys[t.code]=0,console.log(this.keys)}keyIsDown(t){return 1===this.keys[t]||!1}clearKeys(){this.keys={}}}class i{error(t){console.error(t)}warn(t){console.warn(t)}info(t){console.info("â„¹ï¸ "+t)}debug(t){console.log("ðŸ“ "+t)}}class h{constructor(t,e){this.x=t,this.y=e}add(t){return this.x+=t.x,this.y+=t.y,this}sub(t){return this.x-=t.x,this.y-=t.y,this}mul(t){return this.x*=t.x,this.y*=t.y,this}div(t){return this.x/=t.x,this.y/=t.y,this}clone(){return new h(this.x,this.y)}reset(){return this.x=0,this.y=0,this}}class n{constructor(){this.pos=new h(0,0),this.globalPos=new h(0,0),this.vel=new h(0,0),this.size=new h(8,8),this.rotation=0,this.speed=1,this.children=[],this.parent=null,this.id=Math.random().toString(16).substring(0,5)}addChild(t){this.children.includes(t)||(t.parent&&t.parent.removeChild(t),t.parent=this,this.children.push(t))}removeChild(t){t.parent=null,this.children=this.children.filter((e=>e!==t))}debugDraw(t,e=!1){t.ctx.strokeStyle="magenta",t.ctx.strokeRect(this.pos.x,this.pos.y,this.size.x,this.size.y),e&&(t.ctx.strokeStyle="green",t.ctx.font="8px monospace",t.ctx.strokeText(this.id,this.pos.x,this.pos.y-4))}update(t){this.children.forEach((e=>{e.update(t)}))}render(t){this.children.forEach((e=>{e.render(t)})),this.debugDraw(t)}}class o{constructor(){this.health=100,this.exp=0,this.level=1,this.damage=10,this.speed=1,this.defense=1}}const r={game:null,moveDisabled:!1};const a={basic:{damage:10,speed:5,color:"red",size:[2,2]}};var l;!function(t){t.Basic="basic"}(l||(l={}));class d extends n{constructor(t,e,s){super(),this.pos=t,this.vel=e,this.type=s,this.size=new h(a[this.type].size[0],a[this.type].size[1]),this.id="player-bullet"}update(t){this.pos.add(this.vel.clone().mul(new h(a[this.type].speed,a[this.type].speed)))}render(t){this.debugDraw(t),t.ctx.fillStyle=a[this.type].color,t.ctx.fillRect(this.pos.x,this.pos.y,2,2)}}class c extends n{constructor(){super(),this.stats=new o,this.bullets=[],this.id="player",this.size=new h(16,16),this.pos=new h(127.5-this.size.x,120-this.size.y),this.stats.health=50,this.speed=2}fire(){const t=new h(this.pos.x,this.pos.y+16),e=new h(this.pos.x+14,this.pos.y+16),s=new d(t,new h(0,-1),l.Basic);this.bullets.push(s);const i=new d(e,new h(0,-1),l.Basic);this.bullets.push(i),console.log(this.bullets)}move(t){if(r.moveDisabled)return;const e=this.pos.clone(),s=this.pos.clone().add(t.mul(new h(this.speed,this.speed)));s.clone().add(new h(this.size.x,50)).x>=this.parent.size.x+this.parent.pos.x||s.clone().add(new h(0,this.size.y)).y>=this.parent.size.y+this.parent.pos.y||s.x<=this.parent.pos.x||s.y<=this.parent.pos.y||(this.pos=s,s.x<=50&&(this.pos=e,this.parent.pos.x+=this.speed),s.y<=50&&(this.pos=e,this.parent.pos.y+=this.speed),s.clone().add(new h(this.size.x,0)).x>=r.game.renderer.windowSize.width-50&&(this.pos=e,this.parent.pos.x-=this.speed),s.clone().add(new h(0,this.size.y)).y>=r.game.renderer.windowSize.height-50&&(this.pos=e,this.parent.pos.y-=this.speed))}update(t){this.bullets.forEach((e=>{e.update(t)}))}render(t){t.drawSprite(0,24,16,16,this.pos.x,this.pos.y,16,16),this.bullets.forEach((e=>{e.render(t)})),this.bullets=this.bullets.filter((e=>{return s=e,i=t.canvas.width,h=t.canvas.height,!(s.pos.x<0||s.pos.x>i||s.pos.y<0||s.pos.y>h);var s,i,h})),this.debugDraw(t)}}class p{constructor(){this.logger=new i,this.image=new Image,this.windowSize={width:256,height:240},this.spriteSheetMap={},this.canvas=document.createElement("canvas"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,this.ctx.scale(this.canvas.width/this.windowSize.width,this.canvas.height/this.windowSize.height),document.querySelector("#main").append(this.canvas),this.logger.info("Renderer initialized"),window.addEventListener("resize",(()=>this.resize()))}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.ctx.scale(this.canvas.width/this.windowSize.width,this.canvas.height/this.windowSize.height),this.ctx.imageSmoothingEnabled=!1}drawSprite(t,e,s,i,h,n,o,r){this.ctx.drawImage(this.image,t,e,s,i,h,n,o,r)}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}class w extends n{constructor(){super(),this.player=new c}}const y="#000000",u="#ffffff",g="#49aa10",x="#b21030";class m extends p{progress(t,e,s,i=10,h=4){this.ctx.fillStyle=u,this.ctx.fillRect(e-2,s-2,i+4,h+4),this.ctx.fillStyle=u,this.ctx.fillRect(e+i+2,s+1,1,2),this.ctx.fillStyle=y,this.ctx.fillRect(e-1,s-1,i+2,h+2),this.ctx.fillStyle=x,this.ctx.fillRect(e,s,i,4),this.ctx.fillStyle=g,this.ctx.fillRect(e,s,t/i,4)}text(t,e,s){t.split("").forEach(((t,e)=>{this.ctx.drawImage(this.image,this.spriteSheetMap[t].x,this.spriteSheetMap[t].y,this.spriteSheetMap[t].w,this.spriteSheetMap[t].h,8*e,0,8,8)}))}}var f;!function(t){t[t.MENU=0]="MENU",t[t.PLAYING=1]="PLAYING",t[t.PAUSED=2]="PAUSED",t[t.GAME_OVER=3]="GAME_OVER",t[t.OPTIONS=4]="OPTIONS",t[t.LOADING=5]="LOADING",t[t.FLYING=6]="FLYING",t[t.DISEMBARK=7]="DISEMBARK"}(f||(f={}));const S=new class{constructor(){this.renderer=new p,this.uiRenderer=new m,this.assetLoader=new t,this.scene=new w,this.currentState=f.LOADING,this.lastTime=0,this.logger=new i,this.logger.info("Game started"),this.player=new c,this.controller=new s(this),window.game=this}update(t){const e=t-this.lastTime;this.controller.keyIsDown("KeyW")&&this.player.move(new h(0,-1)),this.controller.keyIsDown("KeyA")&&this.player.move(new h(-1,0)),this.controller.keyIsDown("KeyS")&&this.player.move(new h(0,1)),this.controller.keyIsDown("KeyD")&&this.player.move(new h(1,0)),this.controller.keyIsDown("Space")&&this.player.fire(),this.lastTime=t,this.scene.update(e)}changeState(t){this.currentState=t}render(){this.renderer.clear(),this.uiRenderer.clear(),this.scene.render(this.renderer)}run(){this.logger.info("Game running");this.scene.size=new h(512,512),this.scene.pos=new h(-200,-200),this.scene.addChild(this.player),this.assetLoader.load(["assets/spritesheet.png","assets/spritesheet_map.json"]).then((()=>{this.logger.info("Assets loaded"),this.renderer.image=this.assetLoader.list.spritesheet,this.uiRenderer.image=this.assetLoader.list.spritesheet,this.uiRenderer.spriteSheetMap=this.assetLoader.list.spritesheet_map,r.game=this,this.loop()}))}loop(){this.update(performance.now()),this.render(),requestAnimationFrame((()=>this.loop()))}};S.run()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJtYXBwaW5ncyI6Im1CQUNlLE1BQU1BLEVBQ2pCQyxjQUNJQyxLQUFLQyxPQUFTLEVBQ2RELEtBQUtFLE9BQVMsRUFDZEYsS0FBS0csVUFBVyxFQUNoQkgsS0FBS0ksS0FBTyxDQUFDLENBQ2pCLENBQ0FDLEtBQUtDLEdBQ0QsTUFBTUMsRUFBVyxDQUFDLE9BQ1pDLEVBQVUsQ0FBQyxRQUNYQyxFQUFZLENBQUMsUUFFbkIsT0FEQVQsS0FBS0MsT0FBU0ssRUFBT0ksT0FDZCxJQUFJQyxTQUFTQyxJQUNoQk4sRUFBT08sU0FBU0MsSUFDWixNQUFNQyxFQUFZRCxFQUFNRSxNQUFNLEtBQUtDLE9BQVMsR0FDeENWLEVBQVNXLFNBQVNILEdBQ2xCZixLQUFLbUIsVUFBVUwsRUFBT0YsR0FFakJKLEVBQVFVLFNBQVNILEdBQ3RCZixLQUFLb0IsU0FBU04sRUFBT0YsR0FFaEJILEVBQVVTLFNBQVNILElBQ3hCZixLQUFLcUIsV0FBV1AsRUFBT0YsRUFDM0IsR0FDRixHQUVWLENBQ0FVLFlBQVlWLEdBQ1JaLEtBQUtFLFFBQVUsRUFDWEYsS0FBS0UsU0FBV0YsS0FBS0MsU0FDckJELEtBQUtFLE9BQVMsRUFDZEYsS0FBS0MsT0FBUyxFQUNkVyxFQUFRWixNQUNSQSxLQUFLRyxVQUFXLEVBRXhCLENBQ0FnQixVQUFVSSxFQUFLWCxHQUNYLE1BQU1ZLEVBQVEsSUFBSUMsTUFDbEJELEVBQU1ELElBQU1BLEVBQ1pDLEVBQU1FLGlCQUFpQixRQUFRLEtBQzNCMUIsS0FBS3NCLFlBQVlWLEVBQVEsSUFDMUIsR0FDSCxNQUFNZSxFQUFPSixFQUFJUCxNQUFNLEtBQUtDLE1BQU1ELE1BQU0sS0FBSyxHQUN6Q1csSUFDQTNCLEtBQUtJLEtBQUt1QixHQUFRSCxFQUUxQixDQUNBSSxpQkFBaUJMLEVBQUtYLEdBQ2xCaUIsTUFBTU4sR0FDRE8sTUFBTUMsR0FBU0EsRUFBS0MsU0FDcEJGLE1BQU1FLElBQ1AsTUFBTUMsRUFBU0QsRUFBS2hCLE1BQU0sTUFBTWtCLFFBQU8sQ0FBQ0MsRUFBS0MsS0FDekMsTUFBT0MsRUFBS0MsR0FBU0YsRUFBSUcsT0FBT3ZCLE1BQU0sS0FDdEMsT0FBS3FCLEdBQVFDLEdBRWJILEVBQUlFLEVBQUlFLFFBQVVELEVBQU1DLE9BQ2pCSixHQUZJQSxDQUVELEdBQ1gsQ0FBQyxHQUNFUixFQUFPSixFQUFJUCxNQUFNLEtBQUtDLE1BQU1ELE1BQU0sS0FBSyxHQUN6Q1csSUFDQTNCLEtBQUtJLEtBQUt1QixHQUFRTSxFQUN0QixHQUVSLENBQ0FMLGVBQWVMLEVBQUtYLEdBQ2hCLElBQ0ksTUFBTTRCLFFBQWlCWCxNQUFNTixHQUN2QlEsUUFBYVMsRUFBU0MsT0FDNUJ6QyxLQUFLc0IsWUFBWVYsR0FDakIsTUFBTWUsRUFBT0osRUFBSVAsTUFBTSxLQUFLQyxNQUFNRCxNQUFNLEtBQUssR0FDN0NoQixLQUFLSSxLQUFLdUIsR0FBUUksQ0FFTixDQUFoQixNQUFPVyxHQUFTLENBQ3BCLEVDMUVKLE1BQU1DLEVBQWUsQ0FBQyxPQUFRLE9BQVEsT0FBUSxPQUFRLFFBQVMsVUFDaEQsTUFBTUMsRUFDakI3QyxZQUFZOEMsR0FDUjdDLEtBQUs4QyxLQUFPLENBQUMsRUFDYkMsUUFBUUMsSUFBSSxzQkFDWmhELEtBQUs2QyxLQUFPQSxFQUNaN0MsS0FBS2lELE9BQVNKLEVBQUtJLE9BQ25CQyxPQUFPeEIsaUJBQWlCLFdBQVl5QixHQUFNbkQsS0FBS29ELGNBQWNELEtBQzdERCxPQUFPeEIsaUJBQWlCLFNBQVV5QixHQUFNbkQsS0FBS3FELFlBQVlGLElBQzdELENBQ0FDLGNBQWNELEdBQ0xSLEVBQWF6QixTQUFTaUMsRUFBRUcsUUFHN0JILEVBQUVJLGlCQUNGdkQsS0FBSzhDLEtBQUtLLEVBQUVHLE1BQVEsRUFDeEIsQ0FDQUQsWUFBWUYsR0FDUm5ELEtBQUs4QyxLQUFLSyxFQUFFRyxNQUFRLEVBQ3BCUCxRQUFRQyxJQUFJaEQsS0FBSzhDLEtBQ3JCLENBQ0FVLFVBQVVuQixHQUNOLE9BQTBCLElBQW5CckMsS0FBSzhDLEtBQUtULEtBQWMsQ0FDbkMsQ0FDQW9CLFlBQ0l6RCxLQUFLOEMsS0FBTyxDQUFDLENBQ2pCLEVDMUJXLE1BQU1ZLEVBQ2pCaEIsTUFBTWlCLEdBQ0ZaLFFBQVFMLE1BQU1pQixFQUNsQixDQUNBQyxLQUFLRCxHQUNEWixRQUFRYSxLQUFLRCxFQUNqQixDQUNBRSxLQUFLRixHQUNEWixRQUFRYyxLQUFLLE1BQVFGLEVBQ3pCLENBQ0FHLE1BQU1ILEdBQ0ZaLFFBQVFDLElBQUksTUFBUVcsRUFDeEIsRUNaVyxNQUFNSSxFQUNqQmhFLFlBQVlpRSxFQUFHQyxHQUNYakUsS0FBS2dFLEVBQUlBLEVBQ1RoRSxLQUFLaUUsRUFBSUEsQ0FDYixDQUNBQyxJQUFJQyxHQUdBLE9BRkFuRSxLQUFLZ0UsR0FBS0csRUFBRUgsRUFDWmhFLEtBQUtpRSxHQUFLRSxFQUFFRixFQUNMakUsSUFDWCxDQUNBb0UsSUFBSUQsR0FHQSxPQUZBbkUsS0FBS2dFLEdBQUtHLEVBQUVILEVBQ1poRSxLQUFLaUUsR0FBS0UsRUFBRUYsRUFDTGpFLElBQ1gsQ0FDQXFFLElBQUlGLEdBR0EsT0FGQW5FLEtBQUtnRSxHQUFLRyxFQUFFSCxFQUNaaEUsS0FBS2lFLEdBQUtFLEVBQUVGLEVBQ0xqRSxJQUNYLENBQ0FzRSxJQUFJSCxHQUdBLE9BRkFuRSxLQUFLZ0UsR0FBS0csRUFBRUgsRUFDWmhFLEtBQUtpRSxHQUFLRSxFQUFFRixFQUNMakUsSUFDWCxDQUNBdUUsUUFDSSxPQUFPLElBQUlSLEVBQVEvRCxLQUFLZ0UsRUFBR2hFLEtBQUtpRSxFQUNwQyxDQUNBTyxRQUdJLE9BRkF4RSxLQUFLZ0UsRUFBSSxFQUNUaEUsS0FBS2lFLEVBQUksRUFDRmpFLElBQ1gsRUMvQlcsTUFBTXlFLEVBQ2pCMUUsY0FDSUMsS0FBSzBFLElBQU0sSUFBSVgsRUFBUSxFQUFHLEdBQzFCL0QsS0FBSzJFLFVBQVksSUFBSVosRUFBUSxFQUFHLEdBQ2hDL0QsS0FBSzRFLElBQU0sSUFBSWIsRUFBUSxFQUFHLEdBQzFCL0QsS0FBSzZFLEtBQU8sSUFBSWQsRUFBUSxFQUFHLEdBQzNCL0QsS0FBSzhFLFNBQVcsRUFDaEI5RSxLQUFLK0UsTUFBUSxFQUNiL0UsS0FBS2dGLFNBQVcsR0FDaEJoRixLQUFLaUYsT0FBUyxLQUNkakYsS0FBS2tGLEdBQUtDLEtBQUtDLFNBQVNDLFNBQVMsSUFBSUMsVUFBVSxFQUFHLEVBQ3RELENBQ0FDLFNBQVNDLEdBQ0R4RixLQUFLZ0YsU0FBUzlELFNBQVNzRSxLQUd2QkEsRUFBTVAsUUFDTk8sRUFBTVAsT0FBT1EsWUFBWUQsR0FFN0JBLEVBQU1QLE9BQVNqRixLQUNmQSxLQUFLZ0YsU0FBU1UsS0FBS0YsR0FDdkIsQ0FDQUMsWUFBWUQsR0FDUkEsRUFBTVAsT0FBUyxLQUNmakYsS0FBS2dGLFNBQVdoRixLQUFLZ0YsU0FBU1csUUFBUUMsR0FBTUEsSUFBTUosR0FDdEQsQ0FDQUssVUFBVUMsRUFBVWpDLEdBQU8sR0FDdkJpQyxFQUFTQyxJQUFJQyxZQUFjLFVBQzNCRixFQUFTQyxJQUFJRSxXQUFXakcsS0FBSzBFLElBQUlWLEVBQUdoRSxLQUFLMEUsSUFBSVQsRUFBR2pFLEtBQUs2RSxLQUFLYixFQUFHaEUsS0FBSzZFLEtBQUtaLEdBQ25FSixJQUNBaUMsRUFBU0MsSUFBSUMsWUFBYyxRQUMzQkYsRUFBU0MsSUFBSUcsS0FBTyxnQkFDcEJKLEVBQVNDLElBQUlJLFdBQVduRyxLQUFLa0YsR0FBSWxGLEtBQUswRSxJQUFJVixFQUFHaEUsS0FBSzBFLElBQUlULEVBQUksR0FFbEUsQ0FDQW1DLE9BQU9DLEdBQ0hyRyxLQUFLZ0YsU0FBU25FLFNBQVMyRSxJQUNuQkEsRUFBTVksT0FBT0MsRUFBRyxHQUV4QixDQUNBQyxPQUFPUixHQUNIOUYsS0FBS2dGLFNBQVNuRSxTQUFTMkUsSUFDbkJBLEVBQU1jLE9BQU9SLEVBQVMsSUFFMUI5RixLQUFLNkYsVUFBVUMsRUFDbkIsRUFFRyxNQUFNUyxFQUNUeEcsY0FDSUMsS0FBS3dHLE9BQVMsSUFDZHhHLEtBQUt5RyxJQUFNLEVBQ1h6RyxLQUFLMEcsTUFBUSxFQUNiMUcsS0FBSzJHLE9BQVMsR0FDZDNHLEtBQUsrRSxNQUFRLEVBQ2IvRSxLQUFLNEcsUUFBVSxDQUNuQixFQ3hESixNQUlBLEVBSmMsQ0FDVi9ELEtBQU0sS0FDTmdFLGNBQWMsR0NFbEIsTUFBTUMsRUFBYyxDQUNoQkMsTUFBTyxDQUNISixPQUFRLEdBQ1I1QixNQUFPLEVBQ1BpQyxNQUFPLE1BQ1BuQyxLQUFNLENBQUMsRUFBRyxLQUdsQixJQUFJb0MsR0FDSixTQUFXQSxHQUNQQSxFQUFrQixNQUFJLE9BQ3pCLENBRkQsQ0FFR0EsSUFBZUEsRUFBYSxDQUFDLElBQ3pCLE1BQU1DLFVBQWV6QyxFQUN4QjFFLFlBQVkyRSxFQUFLRSxFQUFLdUMsR0FDbEJDLFFBQ0FwSCxLQUFLMEUsSUFBTUEsRUFDWDFFLEtBQUs0RSxJQUFNQSxFQUNYNUUsS0FBS21ILEtBQU9BLEVBQ1puSCxLQUFLNkUsS0FBTyxJQUFJZCxFQUFRK0MsRUFBWTlHLEtBQUttSCxNQUFNdEMsS0FBSyxHQUFJaUMsRUFBWTlHLEtBQUttSCxNQUFNdEMsS0FBSyxJQUNwRjdFLEtBQUtrRixHQUFLLGVBQ2QsQ0FDQWtCLE9BQU9DLEdBQ0hyRyxLQUFLMEUsSUFBSVIsSUFBSWxFLEtBQUs0RSxJQUNiTCxRQUNBRixJQUFJLElBQUlOLEVBQVErQyxFQUFZOUcsS0FBS21ILE1BQU1wQyxNQUFPK0IsRUFBWTlHLEtBQUttSCxNQUFNcEMsUUFDOUUsQ0FDQXVCLE9BQU9SLEdBQ0g5RixLQUFLNkYsVUFBVUMsR0FDZkEsRUFBU0MsSUFBSXNCLFVBQVlQLEVBQVk5RyxLQUFLbUgsTUFBTUgsTUFDaERsQixFQUFTQyxJQUFJdUIsU0FBU3RILEtBQUswRSxJQUFJVixFQUFHaEUsS0FBSzBFLElBQUlULEVBQUcsRUFBRyxFQUNyRCxFQUVXLE1BQU1zRCxVQUFlOUMsRUFDaEMxRSxjQUNJcUgsUUFDQXBILEtBQUt3SCxNQUFRLElBQUlqQixFQUNqQnZHLEtBQUt5SCxRQUFVLEdBQ2Z6SCxLQUFLa0YsR0FBSyxTQUNWbEYsS0FBSzZFLEtBQU8sSUFBSWQsRUFBUSxHQUFJLElBQzVCL0QsS0FBSzBFLElBQU0sSUFBSVgsRUFBUSxNQUFVL0QsS0FBSzZFLEtBQUtiLEVBQUcsSUFBVWhFLEtBQUs2RSxLQUFLWixHQUNsRWpFLEtBQUt3SCxNQUFNaEIsT0FBUyxHQUNwQnhHLEtBQUsrRSxNQUFRLENBQ2pCLENBQ0EyQyxPQUNJLE1BQU1DLEVBQWEsSUFBSTVELEVBQVEvRCxLQUFLMEUsSUFBSVYsRUFBR2hFLEtBQUswRSxJQUFJVCxFQUFJLElBQ2xEMkQsRUFBYyxJQUFJN0QsRUFBUS9ELEtBQUswRSxJQUFJVixFQUFJLEdBQUloRSxLQUFLMEUsSUFBSVQsRUFBSSxJQUN4RDRELEVBQWEsSUFBSVgsRUFBT1MsRUFBWSxJQUFJNUQsRUFBUSxHQUFJLEdBQUlrRCxFQUFXYSxPQUN6RTlILEtBQUt5SCxRQUFRL0IsS0FBS21DLEdBQ2xCLE1BQU1FLEVBQVMsSUFBSWIsRUFBT1UsRUFBYSxJQUFJN0QsRUFBUSxHQUFJLEdBQUlrRCxFQUFXYSxPQUN0RTlILEtBQUt5SCxRQUFRL0IsS0FBS3FDLEdBQ2xCaEYsUUFBUUMsSUFBSWhELEtBQUt5SCxRQUNyQixDQUNBTyxLQUFLQyxHQUNELEdBQUksZUFDQSxPQUVKLE1BQU1DLEVBQVNsSSxLQUFLMEUsSUFBSUgsUUFDbEI0RCxFQUFTbkksS0FBSzBFLElBQ2ZILFFBQ0FMLElBQUkrRCxFQUFVNUQsSUFBSSxJQUFJTixFQUFRL0QsS0FBSytFLE1BQU8vRSxLQUFLK0UsU0FFaERvRCxFQUFPNUQsUUFBUUwsSUFBSSxJQUFJSCxFQUFRL0QsS0FBSzZFLEtBQUtiLEVBRDVCLEtBQzBDQSxHQUN2RGhFLEtBQUtpRixPQUFPSixLQUFLYixFQUFJaEUsS0FBS2lGLE9BQU9QLElBQUlWLEdBQ3JDbUUsRUFBTzVELFFBQVFMLElBQUksSUFBSUgsRUFBUSxFQUFHL0QsS0FBSzZFLEtBQUtaLElBQUlBLEdBQzVDakUsS0FBS2lGLE9BQU9KLEtBQUtaLEVBQUlqRSxLQUFLaUYsT0FBT1AsSUFBSVQsR0FDekNrRSxFQUFPbkUsR0FBS2hFLEtBQUtpRixPQUFPUCxJQUFJVixHQUM1Qm1FLEVBQU9sRSxHQUFLakUsS0FBS2lGLE9BQU9QLElBQUlULElBSTVCakUsS0FBSzBFLElBQU15RCxFQUVYQSxFQUFPbkUsR0FaTSxLQWFiaEUsS0FBSzBFLElBQU13RCxFQUNYbEksS0FBS2lGLE9BQU9QLElBQUlWLEdBQUtoRSxLQUFLK0UsT0FFMUJvRCxFQUFPbEUsR0FoQk0sS0FpQmJqRSxLQUFLMEUsSUFBTXdELEVBQ1hsSSxLQUFLaUYsT0FBT1AsSUFBSVQsR0FBS2pFLEtBQUsrRSxPQUUxQm9ELEVBQU81RCxRQUFRTCxJQUFJLElBQUlILEVBQVEvRCxLQUFLNkUsS0FBS2IsRUFBRyxJQUFJQSxHQUNoRCxpQ0FBdUMsS0FDdkNoRSxLQUFLMEUsSUFBTXdELEVBQ1hsSSxLQUFLaUYsT0FBT1AsSUFBSVYsR0FBS2hFLEtBQUsrRSxPQUUxQm9ELEVBQU81RCxRQUFRTCxJQUFJLElBQUlILEVBQVEsRUFBRy9ELEtBQUs2RSxLQUFLWixJQUFJQSxHQUNoRCxrQ0FBd0MsS0FDeENqRSxLQUFLMEUsSUFBTXdELEVBQ1hsSSxLQUFLaUYsT0FBT1AsSUFBSVQsR0FBS2pFLEtBQUsrRSxPQUVsQyxDQUNBcUIsT0FBT0MsR0FDSHJHLEtBQUt5SCxRQUFRNUcsU0FBU2tILElBQ2xCQSxFQUFPM0IsT0FBT0MsRUFBRyxHQUV6QixDQUNBQyxPQUFPUixHQUNIQSxFQUFTc0MsV0FBVyxFQUFHLEdBQUksR0FBSSxHQUFJcEksS0FBSzBFLElBQUlWLEVBQUdoRSxLQUFLMEUsSUFBSVQsRUFBRyxHQUFJLElBQy9EakUsS0FBS3lILFFBQVE1RyxTQUFTa0gsSUFDbEJBLEVBQU96QixPQUFPUixFQUFTLElBRTNCOUYsS0FBS3lILFFBQVV6SCxLQUFLeUgsUUFBUTlCLFFBQVFvQyxJQUFXLE9Dbkd6QjVGLEVEbUd3QzRGLEVDbkduQ00sRURtRzJDdkMsRUFBU3dDLE9BQU9ELE1DbkdwREUsRURtRzJEekMsRUFBU3dDLE9BQU9DLFNDbEd6R3BHLEVBQUl1QyxJQUFJVixFQUFJLEdBQ2hCN0IsRUFBSXVDLElBQUlWLEVBQUlxRSxHQUNabEcsRUFBSXVDLElBQUlULEVBQUksR0FDWjlCLEVBQUl1QyxJQUFJVCxFQUFJc0UsR0FKYixJQUF1QnBHLEVBQUtrRyxFQUFPRSxDRG1Ha0YsSUFDcEh2SSxLQUFLNkYsVUFBVUMsRUFDbkIsRUUxR1csTUFBTTBDLEVBQ2pCekksY0FDSUMsS0FBS3lJLE9BQVMsSUFBSS9FLEVBQ2xCMUQsS0FBS3dCLE1BQVEsSUFBSUMsTUFDakJ6QixLQUFLMEksV0FBYSxDQUNkTCxNQUFPLElBQ1BFLE9BQVEsS0FFWnZJLEtBQUsySSxlQUFpQixDQUFDLEVBQ3ZCM0ksS0FBS3NJLE9BQVNNLFNBQVNDLGNBQWMsVUFDckM3SSxLQUFLc0ksT0FBT0QsTUFBUW5GLE9BQU80RixXQUMzQjlJLEtBQUtzSSxPQUFPQyxPQUFTckYsT0FBTzZGLFlBQzVCL0ksS0FBSytGLElBQU0vRixLQUFLc0ksT0FBT1UsV0FBVyxNQUNsQ2hKLEtBQUsrRixJQUFJa0QsdUJBQXdCLEVBQ2pDakosS0FBSytGLElBQUltRCxNQUFNbEosS0FBS3NJLE9BQU9ELE1BQVFySSxLQUFLMEksV0FBV0wsTUFBT3JJLEtBQUtzSSxPQUFPQyxPQUFTdkksS0FBSzBJLFdBQVdILFFBQy9GSyxTQUFTTyxjQUFjLFNBQVNDLE9BQU9wSixLQUFLc0ksUUFDNUN0SSxLQUFLeUksT0FBTzVFLEtBQUssd0JBQ2pCWCxPQUFPeEIsaUJBQWlCLFVBQVUsSUFBTTFCLEtBQUtxSixVQUNqRCxDQUNBQSxTQUNJckosS0FBS3NJLE9BQU9ELE1BQVFuRixPQUFPNEYsV0FDM0I5SSxLQUFLc0ksT0FBT0MsT0FBU3JGLE9BQU82RixZQUM1Qi9JLEtBQUsrRixJQUFJbUQsTUFBTWxKLEtBQUtzSSxPQUFPRCxNQUFRckksS0FBSzBJLFdBQVdMLE1BQU9ySSxLQUFLc0ksT0FBT0MsT0FBU3ZJLEtBQUswSSxXQUFXSCxRQUMvRnZJLEtBQUsrRixJQUFJa0QsdUJBQXdCLENBQ3JDLENBQ0FiLFdBQVdrQixFQUFPQyxFQUFPQyxFQUFHQyxFQUFHekYsRUFBR0MsRUFBR3lGLEVBQU9DLEdBQ3hDM0osS0FBSytGLElBQUk2RCxVQUFVNUosS0FBS3dCLE1BQU84SCxFQUFPQyxFQUFPQyxFQUFHQyxFQUFHekYsRUFBR0MsRUFBR3lGLEVBQU9DLEVBQ3BFLENBQ0FFLFFBQ0k3SixLQUFLK0YsSUFBSStELFVBQVUsRUFBRyxFQUFHOUosS0FBS3NJLE9BQU9ELE1BQU9ySSxLQUFLc0ksT0FBT0MsT0FDNUQsRUM3QlcsTUFBTXdCLFVBQWN0RixFQUMvQjFFLGNBQ0lxSCxRQUNBcEgsS0FBS2lELE9BQVMsSUFBSXNFLENBQ3RCLEVDTEosTUFBTXlDLEVBQ0ksVUFESkEsRUFFSSxVQUZKQSxFQUdJLFVBSEpBLEVBSUksVUFFSyxNQUFNQyxVQUFtQnpCLEVBQ3BDMEIsU0FBU0MsRUFBU25HLEVBQUdDLEVBQUdvRSxFQUFRLEdBQUlFLEVBQVMsR0FDekN2SSxLQUFLK0YsSUFBSXNCLFVBQVkyQyxFQUNyQmhLLEtBQUsrRixJQUFJdUIsU0FBU3RELEVBQUksRUFBR0MsRUFBSSxFQUFHb0UsRUFBUSxFQUFHRSxFQUFTLEdBQ3BEdkksS0FBSytGLElBQUlzQixVQUFZMkMsRUFDckJoSyxLQUFLK0YsSUFBSXVCLFNBQVN0RCxFQUFJcUUsRUFBUSxFQUFHcEUsRUFBSSxFQUFHLEVBQUcsR0FDM0NqRSxLQUFLK0YsSUFBSXNCLFVBQVkyQyxFQUNyQmhLLEtBQUsrRixJQUFJdUIsU0FBU3RELEVBQUksRUFBR0MsRUFBSSxFQUFHb0UsRUFBUSxFQUFHRSxFQUFTLEdBQ3BEdkksS0FBSytGLElBQUlzQixVQUFZMkMsRUFDckJoSyxLQUFLK0YsSUFBSXVCLFNBQVN0RCxFQUFHQyxFQUFHb0UsRUFBTyxHQUMvQnJJLEtBQUsrRixJQUFJc0IsVUFBWTJDLEVBQ3JCaEssS0FBSytGLElBQUl1QixTQUFTdEQsRUFBR0MsRUFBR2tHLEVBQVU5QixFQUFPLEVBQzdDLENBQ0FyRyxLQUFLQSxFQUFNZ0MsRUFBR0MsR0FDVmpDLEVBQUtoQixNQUFNLElBQUlILFNBQVEsQ0FBQ3VKLEVBQU1DLEtBQzFCckssS0FBSytGLElBQUk2RCxVQUFVNUosS0FBS3dCLE1BQU94QixLQUFLMkksZUFBZXlCLEdBQU1wRyxFQUFHaEUsS0FBSzJJLGVBQWV5QixHQUFNbkcsRUFBR2pFLEtBQUsySSxlQUFleUIsR0FBTVosRUFBR3hKLEtBQUsySSxlQUFleUIsR0FBTVgsRUFBVyxFQUFSWSxFQUFXLEVBQUcsRUFBRyxFQUFFLEdBRTlLLEVDZkosSUFBSUMsR0FDSixTQUFXQSxHQUNQQSxFQUFVQSxFQUFnQixLQUFJLEdBQUssT0FDbkNBLEVBQVVBLEVBQW1CLFFBQUksR0FBSyxVQUN0Q0EsRUFBVUEsRUFBa0IsT0FBSSxHQUFLLFNBQ3JDQSxFQUFVQSxFQUFxQixVQUFJLEdBQUssWUFDeENBLEVBQVVBLEVBQW1CLFFBQUksR0FBSyxVQUN0Q0EsRUFBVUEsRUFBbUIsUUFBSSxHQUFLLFVBQ3RDQSxFQUFVQSxFQUFrQixPQUFJLEdBQUssU0FDckNBLEVBQVVBLEVBQXFCLFVBQUksR0FBSyxXQUMzQyxDQVRELENBU0dBLElBQWNBLEVBQVksQ0FBQyxJQ2xCOUIsTUFBTXpILEVBQU8sSURtQkUsTUFDWDlDLGNBQ0lDLEtBQUs4RixTQUFXLElBQUkwQyxFQUNwQnhJLEtBQUt1SyxXQUFhLElBQUlOLEVBQ3RCakssS0FBS3dLLFlBQWMsSUFBSTFLLEVBQ3ZCRSxLQUFLeUssTUFBUSxJQUFJVixFQUNqQi9KLEtBQUswSyxhQUFlSixFQUFVSyxRQUM5QjNLLEtBQUs0SyxTQUFXLEVBQ2hCNUssS0FBS3lJLE9BQVMsSUFBSS9FLEVBQ2xCMUQsS0FBS3lJLE9BQU81RSxLQUFLLGdCQUNqQjdELEtBQUtpRCxPQUFTLElBQUlzRSxFQUNsQnZILEtBQUs2SyxXQUFhLElBQUlqSSxFQUFXNUMsTUFFakNrRCxPQUFhLEtBQUlsRCxJQUNyQixDQUNBb0csT0FBTzBFLEdBQ0gsTUFBTXpFLEVBQUt5RSxFQUFLOUssS0FBSzRLLFNBQ2pCNUssS0FBSzZLLFdBQVdySCxVQUFVLFNBQzFCeEQsS0FBS2lELE9BQU8rRSxLQUFLLElBQUlqRSxFQUFRLEdBQUksSUFFakMvRCxLQUFLNkssV0FBV3JILFVBQVUsU0FDMUJ4RCxLQUFLaUQsT0FBTytFLEtBQUssSUFBSWpFLEdBQVMsRUFBRyxJQUVqQy9ELEtBQUs2SyxXQUFXckgsVUFBVSxTQUMxQnhELEtBQUtpRCxPQUFPK0UsS0FBSyxJQUFJakUsRUFBUSxFQUFHLElBRWhDL0QsS0FBSzZLLFdBQVdySCxVQUFVLFNBQzFCeEQsS0FBS2lELE9BQU8rRSxLQUFLLElBQUlqRSxFQUFRLEVBQUcsSUFFaEMvRCxLQUFLNkssV0FBV3JILFVBQVUsVUFDMUJ4RCxLQUFLaUQsT0FBT3lFLE9BRWhCMUgsS0FBSzRLLFNBQVdFLEVBQ2hCOUssS0FBS3lLLE1BQU1yRSxPQUFPQyxFQUN0QixDQUNBMEUsWUFBWUMsR0FDUmhMLEtBQUswSyxhQUFlTSxDQUN4QixDQUNBMUUsU0FDSXRHLEtBQUs4RixTQUFTK0QsUUFDZDdKLEtBQUt1SyxXQUFXVixRQU1oQjdKLEtBQUt5SyxNQUFNbkUsT0FBT3RHLEtBQUs4RixTQUMzQixDQUNBbUYsTUFDSWpMLEtBQUt5SSxPQUFPNUUsS0FBSyxnQkFHakI3RCxLQUFLeUssTUFBTTVGLEtBQU8sSUFBSWQsRUFGSCxJQUNDLEtBRXBCL0QsS0FBS3lLLE1BQU0vRixJQUFNLElBQUlYLEdBQVMsS0FBTSxLQUNwQy9ELEtBQUt5SyxNQUFNbEYsU0FBU3ZGLEtBQUtpRCxRQUN6QmpELEtBQUt3SyxZQUNBbkssS0FBSyxDQUFDLHlCQUEwQixnQ0FDaEN5QixNQUFLLEtBQ045QixLQUFLeUksT0FBTzVFLEtBQUssaUJBQ2pCN0QsS0FBSzhGLFNBQVN0RSxNQUFReEIsS0FBS3dLLFlBQVlwSyxLQUFrQixZQUN6REosS0FBS3VLLFdBQVcvSSxNQUFReEIsS0FBS3dLLFlBQVlwSyxLQUFrQixZQUMzREosS0FBS3VLLFdBQVc1QixlQUFpQjNJLEtBQUt3SyxZQUFZcEssS0FBc0IsZ0JBQ3hFLE9BQWFKLEtBQ2JBLEtBQUtrTCxNQUFNLEdBRW5CLENBQ0FBLE9BQ0lsTCxLQUFLb0csT0FBTytFLFlBQVlDLE9BQ3hCcEwsS0FBS3NHLFNBQ0wrRSx1QkFBc0IsSUFBTXJMLEtBQUtrTCxRQUNyQyxHQ3hGSnJJLEVBQUtvSSxLIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3BhY2VzaG9vdGVyZ2FpZGVuLy4vc3JjL2Fzc2V0bG9hZGVyLnRzIiwid2VicGFjazovL3NwYWNlc2hvb3RlcmdhaWRlbi8uL3NyYy9jb250cm9sbGVyLnRzIiwid2VicGFjazovL3NwYWNlc2hvb3RlcmdhaWRlbi8uL3NyYy9sb2dnZXIudHMiLCJ3ZWJwYWNrOi8vc3BhY2VzaG9vdGVyZ2FpZGVuLy4vc3JjL3ZlY3RvcjIudHMiLCJ3ZWJwYWNrOi8vc3BhY2VzaG9vdGVyZ2FpZGVuLy4vc3JjL2dhbWVvYmplY3QudHMiLCJ3ZWJwYWNrOi8vc3BhY2VzaG9vdGVyZ2FpZGVuLy4vc3JjL3N0YXRlLnRzIiwid2VicGFjazovL3NwYWNlc2hvb3RlcmdhaWRlbi8uL3NyYy9wbGF5ZXIudHMiLCJ3ZWJwYWNrOi8vc3BhY2VzaG9vdGVyZ2FpZGVuLy4vc3JjL3V0aWxzLnRzIiwid2VicGFjazovL3NwYWNlc2hvb3RlcmdhaWRlbi8uL3NyYy9yZW5kZXJlci50cyIsIndlYnBhY2s6Ly9zcGFjZXNob290ZXJnYWlkZW4vLi9zcmMvc2NlbmUudHMiLCJ3ZWJwYWNrOi8vc3BhY2VzaG9vdGVyZ2FpZGVuLy4vc3JjL3VpLXJlbmRlcmVyLnRzIiwid2VicGFjazovL3NwYWNlc2hvb3RlcmdhaWRlbi8uL3NyYy9nYW1lLnRzIiwid2VicGFjazovL3NwYWNlc2hvb3RlcmdhaWRlbi8uL3NyYy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvL0B0cy1ub2NoZWNrXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBc3NldExvYWRlciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMudG9Mb2FkID0gMDtcbiAgICAgICAgdGhpcy5sb2FkZWQgPSAwO1xuICAgICAgICB0aGlzLmlzTG9hZGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMubGlzdCA9IHt9O1xuICAgIH1cbiAgICBsb2FkKGFzc2V0cykge1xuICAgICAgICBjb25zdCBpbWFnZUV4dCA9IFtcInBuZ1wiXTtcbiAgICAgICAgY29uc3QganNvbkV4dCA9IFtcImpzb25cIl07XG4gICAgICAgIGNvbnN0IGNvbmZpZ0V4dCA9IFtcInRvbWxcIl07XG4gICAgICAgIHRoaXMudG9Mb2FkID0gYXNzZXRzLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgICAgICBhc3NldHMuZm9yRWFjaCgoYXNzZXQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBleHRlbnNpb24gPSBhc3NldC5zcGxpdChcIi5cIikucG9wKCkgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICBpZiAoaW1hZ2VFeHQuaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRJbWFnZShhc3NldCwgcmVzb2x2ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGpzb25FeHQuaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRKc29uKGFzc2V0LCByZXNvbHZlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY29uZmlnRXh0LmluY2x1ZGVzKGV4dGVuc2lvbikpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkQ29uZmlnKGFzc2V0LCByZXNvbHZlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGxvYWRIYW5kbGVyKHJlc29sdmUpIHtcbiAgICAgICAgdGhpcy5sb2FkZWQgKz0gMTtcbiAgICAgICAgaWYgKHRoaXMubG9hZGVkID09PSB0aGlzLnRvTG9hZCkge1xuICAgICAgICAgICAgdGhpcy5sb2FkZWQgPSAwO1xuICAgICAgICAgICAgdGhpcy50b0xvYWQgPSAwO1xuICAgICAgICAgICAgcmVzb2x2ZSh0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuaXNMb2FkZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGxvYWRJbWFnZShzcmMsIHJlc29sdmUpIHtcbiAgICAgICAgY29uc3QgaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgaW1hZ2Uuc3JjID0gc3JjO1xuICAgICAgICBpbWFnZS5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxvYWRIYW5kbGVyKHJlc29sdmUpO1xuICAgICAgICB9LCBmYWxzZSk7XG4gICAgICAgIGNvbnN0IG5hbWUgPSBzcmMuc3BsaXQoXCIvXCIpLnBvcCgpLnNwbGl0KFwiLlwiKVswXTtcbiAgICAgICAgaWYgKG5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMubGlzdFtuYW1lXSA9IGltYWdlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIGxvYWRDb25maWcoc3JjLCByZXNvbHZlKSB7XG4gICAgICAgIGZldGNoKHNyYylcbiAgICAgICAgICAgIC50aGVuKChkYXRhKSA9PiBkYXRhLnRleHQoKSlcbiAgICAgICAgICAgIC50aGVuKCh0ZXh0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb25maWcgPSB0ZXh0LnNwbGl0KFwiXFxuXCIpLnJlZHVjZSgob2JqLCBzdHIpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBba2V5LCB2YWx1ZV0gPSBzdHIudHJpbSgpLnNwbGl0KFwiPVwiKTtcbiAgICAgICAgICAgICAgICBpZiAoIWtleSB8fCAhdmFsdWUpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgICAgICAgICAgb2JqW2tleS50cmltKCldID0gdmFsdWUudHJpbSgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgICAgICB9LCB7fSk7XG4gICAgICAgICAgICBjb25zdCBuYW1lID0gc3JjLnNwbGl0KFwiL1wiKS5wb3AoKS5zcGxpdChcIi5cIilbMF07XG4gICAgICAgICAgICBpZiAobmFtZSkge1xuICAgICAgICAgICAgICAgIHRoaXMubGlzdFtuYW1lXSA9IGNvbmZpZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGFzeW5jIGxvYWRKc29uKHNyYywgcmVzb2x2ZSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChzcmMpO1xuICAgICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIHRoaXMubG9hZEhhbmRsZXIocmVzb2x2ZSk7XG4gICAgICAgICAgICBjb25zdCBuYW1lID0gc3JjLnNwbGl0KFwiL1wiKS5wb3AoKS5zcGxpdChcIi5cIilbMF07XG4gICAgICAgICAgICB0aGlzLmxpc3RbbmFtZV0gPSBkYXRhO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikgeyB9XG4gICAgfVxufVxuIiwiY29uc3QgYXBwcm92ZWRLZXlzID0gW1wiS2V5V1wiLCBcIktleUFcIiwgXCJLZXlTXCIsIFwiS2V5RFwiLCBcIlNwYWNlXCIsIFwiRXNjYXBlXCJdO1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29udHJvbGxlciB7XG4gICAgY29uc3RydWN0b3IoZ2FtZSkge1xuICAgICAgICB0aGlzLmtleXMgPSB7fTtcbiAgICAgICAgY29uc29sZS5sb2coXCJDb250cm9sbGVyIGNyZWF0ZWRcIik7XG4gICAgICAgIHRoaXMuZ2FtZSA9IGdhbWU7XG4gICAgICAgIHRoaXMucGxheWVyID0gZ2FtZS5wbGF5ZXI7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZSkgPT4gdGhpcy5oYW5kbGVLZXlEb3duKGUpKTtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCAoZSkgPT4gdGhpcy5oYW5kbGVLZXlVcChlKSk7XG4gICAgfVxuICAgIGhhbmRsZUtleURvd24oZSkge1xuICAgICAgICBpZiAoIWFwcHJvdmVkS2V5cy5pbmNsdWRlcyhlLmNvZGUpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB0aGlzLmtleXNbZS5jb2RlXSA9IDE7XG4gICAgfVxuICAgIGhhbmRsZUtleVVwKGUpIHtcbiAgICAgICAgdGhpcy5rZXlzW2UuY29kZV0gPSAwO1xuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmtleXMpO1xuICAgIH1cbiAgICBrZXlJc0Rvd24oa2V5KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmtleXNba2V5XSA9PT0gMSB8fCBmYWxzZTtcbiAgICB9XG4gICAgY2xlYXJLZXlzKCkge1xuICAgICAgICB0aGlzLmtleXMgPSB7fTtcbiAgICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBMb2dnZXIge1xuICAgIGVycm9yKG1lc3NhZ2UpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihtZXNzYWdlKTtcbiAgICB9XG4gICAgd2FybihtZXNzYWdlKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihtZXNzYWdlKTtcbiAgICB9XG4gICAgaW5mbyhtZXNzYWdlKSB7XG4gICAgICAgIGNvbnNvbGUuaW5mbyhcIuKEue+4jyBcIiArIG1lc3NhZ2UpO1xuICAgIH1cbiAgICBkZWJ1ZyhtZXNzYWdlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwi8J+TnSBcIiArIG1lc3NhZ2UpO1xuICAgIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFZlY3RvcjIge1xuICAgIGNvbnN0cnVjdG9yKHgsIHkpIHtcbiAgICAgICAgdGhpcy54ID0geDtcbiAgICAgICAgdGhpcy55ID0geTtcbiAgICB9XG4gICAgYWRkKHYpIHtcbiAgICAgICAgdGhpcy54ICs9IHYueDtcbiAgICAgICAgdGhpcy55ICs9IHYueTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIHN1Yih2KSB7XG4gICAgICAgIHRoaXMueCAtPSB2Lng7XG4gICAgICAgIHRoaXMueSAtPSB2Lnk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBtdWwodikge1xuICAgICAgICB0aGlzLnggKj0gdi54O1xuICAgICAgICB0aGlzLnkgKj0gdi55O1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgZGl2KHYpIHtcbiAgICAgICAgdGhpcy54IC89IHYueDtcbiAgICAgICAgdGhpcy55IC89IHYueTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIGNsb25lKCkge1xuICAgICAgICByZXR1cm4gbmV3IFZlY3RvcjIodGhpcy54LCB0aGlzLnkpO1xuICAgIH1cbiAgICByZXNldCgpIHtcbiAgICAgICAgdGhpcy54ID0gMDtcbiAgICAgICAgdGhpcy55ID0gMDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxufVxuIiwiaW1wb3J0IFZlY3RvcjIgZnJvbSBcIi4vdmVjdG9yMlwiO1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2FtZU9iamVjdCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMucG9zID0gbmV3IFZlY3RvcjIoMCwgMCk7XG4gICAgICAgIHRoaXMuZ2xvYmFsUG9zID0gbmV3IFZlY3RvcjIoMCwgMCk7XG4gICAgICAgIHRoaXMudmVsID0gbmV3IFZlY3RvcjIoMCwgMCk7XG4gICAgICAgIHRoaXMuc2l6ZSA9IG5ldyBWZWN0b3IyKDgsIDgpO1xuICAgICAgICB0aGlzLnJvdGF0aW9uID0gMDtcbiAgICAgICAgdGhpcy5zcGVlZCA9IDE7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4gPSBbXTtcbiAgICAgICAgdGhpcy5wYXJlbnQgPSBudWxsO1xuICAgICAgICB0aGlzLmlkID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygxNikuc3Vic3RyaW5nKDAsIDUpO1xuICAgIH1cbiAgICBhZGRDaGlsZChjaGlsZCkge1xuICAgICAgICBpZiAodGhpcy5jaGlsZHJlbi5pbmNsdWRlcyhjaGlsZCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2hpbGQucGFyZW50KSB7XG4gICAgICAgICAgICBjaGlsZC5wYXJlbnQucmVtb3ZlQ2hpbGQoY2hpbGQpO1xuICAgICAgICB9XG4gICAgICAgIGNoaWxkLnBhcmVudCA9IHRoaXM7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaChjaGlsZCk7XG4gICAgfVxuICAgIHJlbW92ZUNoaWxkKGNoaWxkKSB7XG4gICAgICAgIGNoaWxkLnBhcmVudCA9IG51bGw7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuLmZpbHRlcigoYykgPT4gYyAhPT0gY2hpbGQpO1xuICAgIH1cbiAgICBkZWJ1Z0RyYXcocmVuZGVyZXIsIGluZm8gPSBmYWxzZSkge1xuICAgICAgICByZW5kZXJlci5jdHguc3Ryb2tlU3R5bGUgPSBcIm1hZ2VudGFcIjtcbiAgICAgICAgcmVuZGVyZXIuY3R4LnN0cm9rZVJlY3QodGhpcy5wb3MueCwgdGhpcy5wb3MueSwgdGhpcy5zaXplLngsIHRoaXMuc2l6ZS55KTtcbiAgICAgICAgaWYgKGluZm8pIHtcbiAgICAgICAgICAgIHJlbmRlcmVyLmN0eC5zdHJva2VTdHlsZSA9IFwiZ3JlZW5cIjtcbiAgICAgICAgICAgIHJlbmRlcmVyLmN0eC5mb250ID0gXCI4cHggbW9ub3NwYWNlXCI7XG4gICAgICAgICAgICByZW5kZXJlci5jdHguc3Ryb2tlVGV4dCh0aGlzLmlkLCB0aGlzLnBvcy54LCB0aGlzLnBvcy55IC0gNCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdXBkYXRlKGR0KSB7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQpID0+IHtcbiAgICAgICAgICAgIGNoaWxkLnVwZGF0ZShkdCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZW5kZXIocmVuZGVyZXIpIHtcbiAgICAgICAgdGhpcy5jaGlsZHJlbi5mb3JFYWNoKChjaGlsZCkgPT4ge1xuICAgICAgICAgICAgY2hpbGQucmVuZGVyKHJlbmRlcmVyKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZGVidWdEcmF3KHJlbmRlcmVyKTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgU3RhdHMge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmhlYWx0aCA9IDEwMDtcbiAgICAgICAgdGhpcy5leHAgPSAwO1xuICAgICAgICB0aGlzLmxldmVsID0gMTtcbiAgICAgICAgdGhpcy5kYW1hZ2UgPSAxMDtcbiAgICAgICAgdGhpcy5zcGVlZCA9IDE7XG4gICAgICAgIHRoaXMuZGVmZW5zZSA9IDE7XG4gICAgfVxufVxuIiwiY29uc3Qgc3RhdGUgPSB7XG4gICAgZ2FtZTogbnVsbCxcbiAgICBtb3ZlRGlzYWJsZWQ6IGZhbHNlLFxufTtcbmV4cG9ydCBkZWZhdWx0IHN0YXRlO1xuIiwiaW1wb3J0IEdhbWVPYmplY3QsIHsgU3RhdHMgfSBmcm9tIFwiLi9nYW1lb2JqZWN0XCI7XG5pbXBvcnQgc3RhdGUgZnJvbSBcIi4vc3RhdGVcIjtcbmltcG9ydCB7IGlzT3V0T2ZTY3JlZW4gfSBmcm9tIFwiLi91dGlsc1wiO1xuaW1wb3J0IFZlY3RvcjIgZnJvbSBcIi4vdmVjdG9yMlwiO1xuY29uc3Qgd2VhcG9uVHlwZXMgPSB7XG4gICAgYmFzaWM6IHtcbiAgICAgICAgZGFtYWdlOiAxMCxcbiAgICAgICAgc3BlZWQ6IDUsXG4gICAgICAgIGNvbG9yOiBcInJlZFwiLFxuICAgICAgICBzaXplOiBbMiwgMl0sXG4gICAgfSxcbn07XG52YXIgV2VhcG9uVHlwZTtcbihmdW5jdGlvbiAoV2VhcG9uVHlwZSkge1xuICAgIFdlYXBvblR5cGVbXCJCYXNpY1wiXSA9IFwiYmFzaWNcIjtcbn0pKFdlYXBvblR5cGUgfHwgKFdlYXBvblR5cGUgPSB7fSkpO1xuZXhwb3J0IGNsYXNzIEJ1bGxldCBleHRlbmRzIEdhbWVPYmplY3Qge1xuICAgIGNvbnN0cnVjdG9yKHBvcywgdmVsLCB0eXBlKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMucG9zID0gcG9zO1xuICAgICAgICB0aGlzLnZlbCA9IHZlbDtcbiAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgICAgdGhpcy5zaXplID0gbmV3IFZlY3RvcjIod2VhcG9uVHlwZXNbdGhpcy50eXBlXS5zaXplWzBdLCB3ZWFwb25UeXBlc1t0aGlzLnR5cGVdLnNpemVbMV0pO1xuICAgICAgICB0aGlzLmlkID0gXCJwbGF5ZXItYnVsbGV0XCI7XG4gICAgfVxuICAgIHVwZGF0ZShkdCkge1xuICAgICAgICB0aGlzLnBvcy5hZGQodGhpcy52ZWxcbiAgICAgICAgICAgIC5jbG9uZSgpXG4gICAgICAgICAgICAubXVsKG5ldyBWZWN0b3IyKHdlYXBvblR5cGVzW3RoaXMudHlwZV0uc3BlZWQsIHdlYXBvblR5cGVzW3RoaXMudHlwZV0uc3BlZWQpKSk7XG4gICAgfVxuICAgIHJlbmRlcihyZW5kZXJlcikge1xuICAgICAgICB0aGlzLmRlYnVnRHJhdyhyZW5kZXJlcik7XG4gICAgICAgIHJlbmRlcmVyLmN0eC5maWxsU3R5bGUgPSB3ZWFwb25UeXBlc1t0aGlzLnR5cGVdLmNvbG9yO1xuICAgICAgICByZW5kZXJlci5jdHguZmlsbFJlY3QodGhpcy5wb3MueCwgdGhpcy5wb3MueSwgMiwgMik7XG4gICAgfVxufVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGxheWVyIGV4dGVuZHMgR2FtZU9iamVjdCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuc3RhdHMgPSBuZXcgU3RhdHMoKTtcbiAgICAgICAgdGhpcy5idWxsZXRzID0gW107XG4gICAgICAgIHRoaXMuaWQgPSBcInBsYXllclwiO1xuICAgICAgICB0aGlzLnNpemUgPSBuZXcgVmVjdG9yMigxNiwgMTYpO1xuICAgICAgICB0aGlzLnBvcyA9IG5ldyBWZWN0b3IyKDI1NSAvIDIgLSB0aGlzLnNpemUueCwgMjQwIC8gMiAtIHRoaXMuc2l6ZS55KTtcbiAgICAgICAgdGhpcy5zdGF0cy5oZWFsdGggPSA1MDtcbiAgICAgICAgdGhpcy5zcGVlZCA9IDI7XG4gICAgfVxuICAgIGZpcmUoKSB7XG4gICAgICAgIGNvbnN0IGxlZnRHdW5Qb3MgPSBuZXcgVmVjdG9yMih0aGlzLnBvcy54LCB0aGlzLnBvcy55ICsgMTYpO1xuICAgICAgICBjb25zdCByaWdodEd1blBvcyA9IG5ldyBWZWN0b3IyKHRoaXMucG9zLnggKyAxNCwgdGhpcy5wb3MueSArIDE2KTtcbiAgICAgICAgY29uc3QgbGVmdEJ1bGxldCA9IG5ldyBCdWxsZXQobGVmdEd1blBvcywgbmV3IFZlY3RvcjIoMCwgLTEpLCBXZWFwb25UeXBlLkJhc2ljKTtcbiAgICAgICAgdGhpcy5idWxsZXRzLnB1c2gobGVmdEJ1bGxldCk7XG4gICAgICAgIGNvbnN0IGJ1bGxldCA9IG5ldyBCdWxsZXQocmlnaHRHdW5Qb3MsIG5ldyBWZWN0b3IyKDAsIC0xKSwgV2VhcG9uVHlwZS5CYXNpYyk7XG4gICAgICAgIHRoaXMuYnVsbGV0cy5wdXNoKGJ1bGxldCk7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuYnVsbGV0cyk7XG4gICAgfVxuICAgIG1vdmUoZGlyZWN0aW9uKSB7XG4gICAgICAgIGlmIChzdGF0ZS5tb3ZlRGlzYWJsZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvbGRQb3MgPSB0aGlzLnBvcy5jbG9uZSgpO1xuICAgICAgICBjb25zdCBuZXdQb3MgPSB0aGlzLnBvc1xuICAgICAgICAgICAgLmNsb25lKClcbiAgICAgICAgICAgIC5hZGQoZGlyZWN0aW9uLm11bChuZXcgVmVjdG9yMih0aGlzLnNwZWVkLCB0aGlzLnNwZWVkKSkpO1xuICAgICAgICBjb25zdCBkaXN0YW5jZSA9IDUwO1xuICAgICAgICBpZiAobmV3UG9zLmNsb25lKCkuYWRkKG5ldyBWZWN0b3IyKHRoaXMuc2l6ZS54LCBkaXN0YW5jZSkpLnggPj1cbiAgICAgICAgICAgIHRoaXMucGFyZW50LnNpemUueCArIHRoaXMucGFyZW50LnBvcy54IHx8XG4gICAgICAgICAgICBuZXdQb3MuY2xvbmUoKS5hZGQobmV3IFZlY3RvcjIoMCwgdGhpcy5zaXplLnkpKS55ID49XG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnQuc2l6ZS55ICsgdGhpcy5wYXJlbnQucG9zLnkgfHxcbiAgICAgICAgICAgIG5ld1Bvcy54IDw9IHRoaXMucGFyZW50LnBvcy54IHx8XG4gICAgICAgICAgICBuZXdQb3MueSA8PSB0aGlzLnBhcmVudC5wb3MueSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5wb3MgPSBuZXdQb3M7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5ld1Bvcy54IDw9IGRpc3RhbmNlKSB7XG4gICAgICAgICAgICB0aGlzLnBvcyA9IG9sZFBvcztcbiAgICAgICAgICAgIHRoaXMucGFyZW50LnBvcy54ICs9IHRoaXMuc3BlZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5ld1Bvcy55IDw9IGRpc3RhbmNlKSB7XG4gICAgICAgICAgICB0aGlzLnBvcyA9IG9sZFBvcztcbiAgICAgICAgICAgIHRoaXMucGFyZW50LnBvcy55ICs9IHRoaXMuc3BlZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5ld1Bvcy5jbG9uZSgpLmFkZChuZXcgVmVjdG9yMih0aGlzLnNpemUueCwgMCkpLnggPj1cbiAgICAgICAgICAgIHN0YXRlLmdhbWUucmVuZGVyZXIud2luZG93U2l6ZS53aWR0aCAtIDUwKSB7XG4gICAgICAgICAgICB0aGlzLnBvcyA9IG9sZFBvcztcbiAgICAgICAgICAgIHRoaXMucGFyZW50LnBvcy54IC09IHRoaXMuc3BlZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5ld1Bvcy5jbG9uZSgpLmFkZChuZXcgVmVjdG9yMigwLCB0aGlzLnNpemUueSkpLnkgPj1cbiAgICAgICAgICAgIHN0YXRlLmdhbWUucmVuZGVyZXIud2luZG93U2l6ZS5oZWlnaHQgLSA1MCkge1xuICAgICAgICAgICAgdGhpcy5wb3MgPSBvbGRQb3M7XG4gICAgICAgICAgICB0aGlzLnBhcmVudC5wb3MueSAtPSB0aGlzLnNwZWVkO1xuICAgICAgICB9XG4gICAgfVxuICAgIHVwZGF0ZShkdCkge1xuICAgICAgICB0aGlzLmJ1bGxldHMuZm9yRWFjaCgoYnVsbGV0KSA9PiB7XG4gICAgICAgICAgICBidWxsZXQudXBkYXRlKGR0KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJlbmRlcihyZW5kZXJlcikge1xuICAgICAgICByZW5kZXJlci5kcmF3U3ByaXRlKDAsIDI0LCAxNiwgMTYsIHRoaXMucG9zLngsIHRoaXMucG9zLnksIDE2LCAxNik7XG4gICAgICAgIHRoaXMuYnVsbGV0cy5mb3JFYWNoKChidWxsZXQpID0+IHtcbiAgICAgICAgICAgIGJ1bGxldC5yZW5kZXIocmVuZGVyZXIpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5idWxsZXRzID0gdGhpcy5idWxsZXRzLmZpbHRlcigoYnVsbGV0KSA9PiAhaXNPdXRPZlNjcmVlbihidWxsZXQsIHJlbmRlcmVyLmNhbnZhcy53aWR0aCwgcmVuZGVyZXIuY2FudmFzLmhlaWdodCkpO1xuICAgICAgICB0aGlzLmRlYnVnRHJhdyhyZW5kZXJlcik7XG4gICAgfVxufVxuIiwiZXhwb3J0IGZ1bmN0aW9uIGlzQ29sbGlkZShhLCBiKSB7XG4gICAgcmV0dXJuIChhLnBvcy54IDwgYi5wb3MueCArIGIuc2l6ZS54ICYmXG4gICAgICAgIGEucG9zLnggKyBhLnNpemUueCA+IGIucG9zLnggJiZcbiAgICAgICAgYS5wb3MueSA8IGIucG9zLnkgKyBiLnNpemUueSAmJlxuICAgICAgICBhLnBvcy55ICsgYS5zaXplLnkgPiBiLnBvcy55KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpc091dE9mU2NyZWVuKG9iaiwgd2lkdGgsIGhlaWdodCkge1xuICAgIHJldHVybiAob2JqLnBvcy54IDwgMCB8fFxuICAgICAgICBvYmoucG9zLnggPiB3aWR0aCB8fFxuICAgICAgICBvYmoucG9zLnkgPCAwIHx8XG4gICAgICAgIG9iai5wb3MueSA+IGhlaWdodCk7XG59XG4iLCJpbXBvcnQgTG9nZ2VyIGZyb20gXCIuL2xvZ2dlclwiO1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUmVuZGVyZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmxvZ2dlciA9IG5ldyBMb2dnZXIoKTtcbiAgICAgICAgdGhpcy5pbWFnZSA9IG5ldyBJbWFnZSgpO1xuICAgICAgICB0aGlzLndpbmRvd1NpemUgPSB7XG4gICAgICAgICAgICB3aWR0aDogMjU2LFxuICAgICAgICAgICAgaGVpZ2h0OiAyNDAsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuc3ByaXRlU2hlZXRNYXAgPSB7fTtcbiAgICAgICAgdGhpcy5jYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAgICAgICB0aGlzLmNhbnZhcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgICAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgICAgIHRoaXMuY3R4ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgICB0aGlzLmN0eC5pbWFnZVNtb290aGluZ0VuYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jdHguc2NhbGUodGhpcy5jYW52YXMud2lkdGggLyB0aGlzLndpbmRvd1NpemUud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCAvIHRoaXMud2luZG93U2l6ZS5oZWlnaHQpO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21haW5cIikuYXBwZW5kKHRoaXMuY2FudmFzKTtcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhcIlJlbmRlcmVyIGluaXRpYWxpemVkXCIpO1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCAoKSA9PiB0aGlzLnJlc2l6ZSgpKTtcbiAgICB9XG4gICAgcmVzaXplKCkge1xuICAgICAgICB0aGlzLmNhbnZhcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgICAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgICAgIHRoaXMuY3R4LnNjYWxlKHRoaXMuY2FudmFzLndpZHRoIC8gdGhpcy53aW5kb3dTaXplLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQgLyB0aGlzLndpbmRvd1NpemUuaGVpZ2h0KTtcbiAgICAgICAgdGhpcy5jdHguaW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gZmFsc2U7XG4gICAgfVxuICAgIGRyYXdTcHJpdGUodGlsZVgsIHRpbGVZLCB3LCBoLCB4LCB5LCBzaXplWCwgc2l6ZVkpIHtcbiAgICAgICAgdGhpcy5jdHguZHJhd0ltYWdlKHRoaXMuaW1hZ2UsIHRpbGVYLCB0aWxlWSwgdywgaCwgeCwgeSwgc2l6ZVgsIHNpemVZKTtcbiAgICB9XG4gICAgY2xlYXIoKSB7XG4gICAgICAgIHRoaXMuY3R4LmNsZWFyUmVjdCgwLCAwLCB0aGlzLmNhbnZhcy53aWR0aCwgdGhpcy5jYW52YXMuaGVpZ2h0KTtcbiAgICB9XG59XG4iLCJpbXBvcnQgR2FtZU9iamVjdCBmcm9tIFwiLi9nYW1lb2JqZWN0XCI7XG5pbXBvcnQgUGxheWVyIGZyb20gXCIuL3BsYXllclwiO1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2NlbmUgZXh0ZW5kcyBHYW1lT2JqZWN0IHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5wbGF5ZXIgPSBuZXcgUGxheWVyKCk7XG4gICAgfVxufVxuIiwiaW1wb3J0IFJlbmRlcmVyIGZyb20gXCIuL3JlbmRlcmVyXCI7XG5jb25zdCBwYWxldHRlID0ge1xuICAgIDB4MDA6IFwiIzAwMDAwMFwiLFxuICAgIDB4MDE6IFwiI2ZmZmZmZlwiLFxuICAgIDB4MDI6IFwiIzQ5YWExMFwiLFxuICAgIDB4MDQ6IFwiI2IyMTAzMFwiLFxufTtcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFVJUmVuZGVyZXIgZXh0ZW5kcyBSZW5kZXJlciB7XG4gICAgcHJvZ3Jlc3MocGVyY2VudCwgeCwgeSwgd2lkdGggPSAxMCwgaGVpZ2h0ID0gNCkge1xuICAgICAgICB0aGlzLmN0eC5maWxsU3R5bGUgPSBwYWxldHRlWzB4MDFdO1xuICAgICAgICB0aGlzLmN0eC5maWxsUmVjdCh4IC0gMiwgeSAtIDIsIHdpZHRoICsgNCwgaGVpZ2h0ICsgNCk7XG4gICAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZSA9IHBhbGV0dGVbMHgwMV07XG4gICAgICAgIHRoaXMuY3R4LmZpbGxSZWN0KHggKyB3aWR0aCArIDIsIHkgKyAxLCAxLCAyKTtcbiAgICAgICAgdGhpcy5jdHguZmlsbFN0eWxlID0gcGFsZXR0ZVsweDAwXTtcbiAgICAgICAgdGhpcy5jdHguZmlsbFJlY3QoeCAtIDEsIHkgLSAxLCB3aWR0aCArIDIsIGhlaWdodCArIDIpO1xuICAgICAgICB0aGlzLmN0eC5maWxsU3R5bGUgPSBwYWxldHRlWzB4MDRdO1xuICAgICAgICB0aGlzLmN0eC5maWxsUmVjdCh4LCB5LCB3aWR0aCwgNCk7XG4gICAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZSA9IHBhbGV0dGVbMHgwMl07XG4gICAgICAgIHRoaXMuY3R4LmZpbGxSZWN0KHgsIHksIHBlcmNlbnQgLyB3aWR0aCwgNCk7XG4gICAgfVxuICAgIHRleHQodGV4dCwgeCwgeSkge1xuICAgICAgICB0ZXh0LnNwbGl0KFwiXCIpLmZvckVhY2goKGNoYXIsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmN0eC5kcmF3SW1hZ2UodGhpcy5pbWFnZSwgdGhpcy5zcHJpdGVTaGVldE1hcFtjaGFyXS54LCB0aGlzLnNwcml0ZVNoZWV0TWFwW2NoYXJdLnksIHRoaXMuc3ByaXRlU2hlZXRNYXBbY2hhcl0udywgdGhpcy5zcHJpdGVTaGVldE1hcFtjaGFyXS5oLCBpbmRleCAqIDgsIDAsIDgsIDgpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG4iLCJpbXBvcnQgQXNzZXRMb2FkZXIgZnJvbSBcIi4vYXNzZXRsb2FkZXJcIjtcbmltcG9ydCBDb250cm9sbGVyIGZyb20gXCIuL2NvbnRyb2xsZXJcIjtcbmltcG9ydCBMb2dnZXIgZnJvbSBcIi4vbG9nZ2VyXCI7XG5pbXBvcnQgUGxheWVyIGZyb20gXCIuL3BsYXllclwiO1xuaW1wb3J0IFJlbmRlcmVyIGZyb20gXCIuL3JlbmRlcmVyXCI7XG5pbXBvcnQgU2NlbmUgZnJvbSBcIi4vc2NlbmVcIjtcbmltcG9ydCBzdGF0ZSBmcm9tIFwiLi9zdGF0ZVwiO1xuaW1wb3J0IFVJUmVuZGVyZXIgZnJvbSBcIi4vdWktcmVuZGVyZXJcIjtcbmltcG9ydCBWZWN0b3IyIGZyb20gXCIuL3ZlY3RvcjJcIjtcbnZhciBHYW1lU3RhdGU7XG4oZnVuY3Rpb24gKEdhbWVTdGF0ZSkge1xuICAgIEdhbWVTdGF0ZVtHYW1lU3RhdGVbXCJNRU5VXCJdID0gMF0gPSBcIk1FTlVcIjtcbiAgICBHYW1lU3RhdGVbR2FtZVN0YXRlW1wiUExBWUlOR1wiXSA9IDFdID0gXCJQTEFZSU5HXCI7XG4gICAgR2FtZVN0YXRlW0dhbWVTdGF0ZVtcIlBBVVNFRFwiXSA9IDJdID0gXCJQQVVTRURcIjtcbiAgICBHYW1lU3RhdGVbR2FtZVN0YXRlW1wiR0FNRV9PVkVSXCJdID0gM10gPSBcIkdBTUVfT1ZFUlwiO1xuICAgIEdhbWVTdGF0ZVtHYW1lU3RhdGVbXCJPUFRJT05TXCJdID0gNF0gPSBcIk9QVElPTlNcIjtcbiAgICBHYW1lU3RhdGVbR2FtZVN0YXRlW1wiTE9BRElOR1wiXSA9IDVdID0gXCJMT0FESU5HXCI7XG4gICAgR2FtZVN0YXRlW0dhbWVTdGF0ZVtcIkZMWUlOR1wiXSA9IDZdID0gXCJGTFlJTkdcIjtcbiAgICBHYW1lU3RhdGVbR2FtZVN0YXRlW1wiRElTRU1CQVJLXCJdID0gN10gPSBcIkRJU0VNQkFSS1wiO1xufSkoR2FtZVN0YXRlIHx8IChHYW1lU3RhdGUgPSB7fSkpO1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2FtZSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIgPSBuZXcgUmVuZGVyZXIoKTtcbiAgICAgICAgdGhpcy51aVJlbmRlcmVyID0gbmV3IFVJUmVuZGVyZXIoKTtcbiAgICAgICAgdGhpcy5hc3NldExvYWRlciA9IG5ldyBBc3NldExvYWRlcigpO1xuICAgICAgICB0aGlzLnNjZW5lID0gbmV3IFNjZW5lKCk7XG4gICAgICAgIHRoaXMuY3VycmVudFN0YXRlID0gR2FtZVN0YXRlLkxPQURJTkc7XG4gICAgICAgIHRoaXMubGFzdFRpbWUgPSAwO1xuICAgICAgICB0aGlzLmxvZ2dlciA9IG5ldyBMb2dnZXIoKTtcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhcIkdhbWUgc3RhcnRlZFwiKTtcbiAgICAgICAgdGhpcy5wbGF5ZXIgPSBuZXcgUGxheWVyKCk7XG4gICAgICAgIHRoaXMuY29udHJvbGxlciA9IG5ldyBDb250cm9sbGVyKHRoaXMpO1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIHdpbmRvd1tcImdhbWVcIl0gPSB0aGlzO1xuICAgIH1cbiAgICB1cGRhdGUodHMpIHtcbiAgICAgICAgY29uc3QgZHQgPSB0cyAtIHRoaXMubGFzdFRpbWU7XG4gICAgICAgIGlmICh0aGlzLmNvbnRyb2xsZXIua2V5SXNEb3duKFwiS2V5V1wiKSkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIubW92ZShuZXcgVmVjdG9yMigwLCAtMSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNvbnRyb2xsZXIua2V5SXNEb3duKFwiS2V5QVwiKSkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIubW92ZShuZXcgVmVjdG9yMigtMSwgMCkpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNvbnRyb2xsZXIua2V5SXNEb3duKFwiS2V5U1wiKSkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIubW92ZShuZXcgVmVjdG9yMigwLCAxKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY29udHJvbGxlci5rZXlJc0Rvd24oXCJLZXlEXCIpKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5tb3ZlKG5ldyBWZWN0b3IyKDEsIDApKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jb250cm9sbGVyLmtleUlzRG93bihcIlNwYWNlXCIpKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5maXJlKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sYXN0VGltZSA9IHRzO1xuICAgICAgICB0aGlzLnNjZW5lLnVwZGF0ZShkdCk7XG4gICAgfVxuICAgIGNoYW5nZVN0YXRlKHN0YXRlKSB7XG4gICAgICAgIHRoaXMuY3VycmVudFN0YXRlID0gc3RhdGU7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5jbGVhcigpO1xuICAgICAgICB0aGlzLnVpUmVuZGVyZXIuY2xlYXIoKTtcbiAgICAgICAgLy90aGlzLnVpUmVuZGVyZXIucHJvZ3Jlc3MoXG4gICAgICAgIC8vICB0aGlzLnBsYXllci5zdGF0cy5oZWFsdGgsXG4gICAgICAgIC8vICB0aGlzLnJlbmRlcmVyLndpbmRvd1NpemUud2lkdGggLSAyOCxcbiAgICAgICAgLy8gIDhcbiAgICAgICAgLy8pO1xuICAgICAgICB0aGlzLnNjZW5lLnJlbmRlcih0aGlzLnJlbmRlcmVyKTtcbiAgICB9XG4gICAgcnVuKCkge1xuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKFwiR2FtZSBydW5uaW5nXCIpO1xuICAgICAgICBjb25zdCBsZXZlbFdpZHRoID0gNTEyO1xuICAgICAgICBjb25zdCBsZXZlbEhlaWdodCA9IDUxMjtcbiAgICAgICAgdGhpcy5zY2VuZS5zaXplID0gbmV3IFZlY3RvcjIobGV2ZWxXaWR0aCwgbGV2ZWxIZWlnaHQpO1xuICAgICAgICB0aGlzLnNjZW5lLnBvcyA9IG5ldyBWZWN0b3IyKC0yMDAsIC0yMDApO1xuICAgICAgICB0aGlzLnNjZW5lLmFkZENoaWxkKHRoaXMucGxheWVyKTtcbiAgICAgICAgdGhpcy5hc3NldExvYWRlclxuICAgICAgICAgICAgLmxvYWQoW1wiYXNzZXRzL3Nwcml0ZXNoZWV0LnBuZ1wiLCBcImFzc2V0cy9zcHJpdGVzaGVldF9tYXAuanNvblwiXSlcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmluZm8oXCJBc3NldHMgbG9hZGVkXCIpO1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5pbWFnZSA9IHRoaXMuYXNzZXRMb2FkZXIubGlzdFtcInNwcml0ZXNoZWV0XCJdO1xuICAgICAgICAgICAgdGhpcy51aVJlbmRlcmVyLmltYWdlID0gdGhpcy5hc3NldExvYWRlci5saXN0W1wic3ByaXRlc2hlZXRcIl07XG4gICAgICAgICAgICB0aGlzLnVpUmVuZGVyZXIuc3ByaXRlU2hlZXRNYXAgPSB0aGlzLmFzc2V0TG9hZGVyLmxpc3RbXCJzcHJpdGVzaGVldF9tYXBcIl07XG4gICAgICAgICAgICBzdGF0ZS5nYW1lID0gdGhpcztcbiAgICAgICAgICAgIHRoaXMubG9vcCgpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgbG9vcCgpIHtcbiAgICAgICAgdGhpcy51cGRhdGUocGVyZm9ybWFuY2Uubm93KCkpO1xuICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5sb29wKCkpO1xuICAgIH1cbn1cbiIsImltcG9ydCBHYW1lIGZyb20gXCIuL2dhbWVcIjtcbmNvbnN0IGdhbWUgPSBuZXcgR2FtZSgpO1xuZ2FtZS5ydW4oKTtcbiJdLCJuYW1lcyI6WyJBc3NldExvYWRlciIsImNvbnN0cnVjdG9yIiwidGhpcyIsInRvTG9hZCIsImxvYWRlZCIsImlzTG9hZGVkIiwibGlzdCIsImxvYWQiLCJhc3NldHMiLCJpbWFnZUV4dCIsImpzb25FeHQiLCJjb25maWdFeHQiLCJsZW5ndGgiLCJQcm9taXNlIiwicmVzb2x2ZSIsImZvckVhY2giLCJhc3NldCIsImV4dGVuc2lvbiIsInNwbGl0IiwicG9wIiwiaW5jbHVkZXMiLCJsb2FkSW1hZ2UiLCJsb2FkSnNvbiIsImxvYWRDb25maWciLCJsb2FkSGFuZGxlciIsInNyYyIsImltYWdlIiwiSW1hZ2UiLCJhZGRFdmVudExpc3RlbmVyIiwibmFtZSIsImFzeW5jIiwiZmV0Y2giLCJ0aGVuIiwiZGF0YSIsInRleHQiLCJjb25maWciLCJyZWR1Y2UiLCJvYmoiLCJzdHIiLCJrZXkiLCJ2YWx1ZSIsInRyaW0iLCJyZXNwb25zZSIsImpzb24iLCJlcnJvciIsImFwcHJvdmVkS2V5cyIsIkNvbnRyb2xsZXIiLCJnYW1lIiwia2V5cyIsImNvbnNvbGUiLCJsb2ciLCJwbGF5ZXIiLCJ3aW5kb3ciLCJlIiwiaGFuZGxlS2V5RG93biIsImhhbmRsZUtleVVwIiwiY29kZSIsInByZXZlbnREZWZhdWx0Iiwia2V5SXNEb3duIiwiY2xlYXJLZXlzIiwiTG9nZ2VyIiwibWVzc2FnZSIsIndhcm4iLCJpbmZvIiwiZGVidWciLCJWZWN0b3IyIiwieCIsInkiLCJhZGQiLCJ2Iiwic3ViIiwibXVsIiwiZGl2IiwiY2xvbmUiLCJyZXNldCIsIkdhbWVPYmplY3QiLCJwb3MiLCJnbG9iYWxQb3MiLCJ2ZWwiLCJzaXplIiwicm90YXRpb24iLCJzcGVlZCIsImNoaWxkcmVuIiwicGFyZW50IiwiaWQiLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHJpbmciLCJhZGRDaGlsZCIsImNoaWxkIiwicmVtb3ZlQ2hpbGQiLCJwdXNoIiwiZmlsdGVyIiwiYyIsImRlYnVnRHJhdyIsInJlbmRlcmVyIiwiY3R4Iiwic3Ryb2tlU3R5bGUiLCJzdHJva2VSZWN0IiwiZm9udCIsInN0cm9rZVRleHQiLCJ1cGRhdGUiLCJkdCIsInJlbmRlciIsIlN0YXRzIiwiaGVhbHRoIiwiZXhwIiwibGV2ZWwiLCJkYW1hZ2UiLCJkZWZlbnNlIiwibW92ZURpc2FibGVkIiwid2VhcG9uVHlwZXMiLCJiYXNpYyIsImNvbG9yIiwiV2VhcG9uVHlwZSIsIkJ1bGxldCIsInR5cGUiLCJzdXBlciIsImZpbGxTdHlsZSIsImZpbGxSZWN0IiwiUGxheWVyIiwic3RhdHMiLCJidWxsZXRzIiwiZmlyZSIsImxlZnRHdW5Qb3MiLCJyaWdodEd1blBvcyIsImxlZnRCdWxsZXQiLCJCYXNpYyIsImJ1bGxldCIsIm1vdmUiLCJkaXJlY3Rpb24iLCJvbGRQb3MiLCJuZXdQb3MiLCJkcmF3U3ByaXRlIiwid2lkdGgiLCJjYW52YXMiLCJoZWlnaHQiLCJSZW5kZXJlciIsImxvZ2dlciIsIndpbmRvd1NpemUiLCJzcHJpdGVTaGVldE1hcCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImlubmVyV2lkdGgiLCJpbm5lckhlaWdodCIsImdldENvbnRleHQiLCJpbWFnZVNtb290aGluZ0VuYWJsZWQiLCJzY2FsZSIsInF1ZXJ5U2VsZWN0b3IiLCJhcHBlbmQiLCJyZXNpemUiLCJ0aWxlWCIsInRpbGVZIiwidyIsImgiLCJzaXplWCIsInNpemVZIiwiZHJhd0ltYWdlIiwiY2xlYXIiLCJjbGVhclJlY3QiLCJTY2VuZSIsInBhbGV0dGUiLCJVSVJlbmRlcmVyIiwicHJvZ3Jlc3MiLCJwZXJjZW50IiwiY2hhciIsImluZGV4IiwiR2FtZVN0YXRlIiwidWlSZW5kZXJlciIsImFzc2V0TG9hZGVyIiwic2NlbmUiLCJjdXJyZW50U3RhdGUiLCJMT0FESU5HIiwibGFzdFRpbWUiLCJjb250cm9sbGVyIiwidHMiLCJjaGFuZ2VTdGF0ZSIsInN0YXRlIiwicnVuIiwibG9vcCIsInBlcmZvcm1hbmNlIiwibm93IiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIl0sInNvdXJjZVJvb3QiOiIifQ==