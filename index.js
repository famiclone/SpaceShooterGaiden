(()=>{"use strict";class e{constructor(){this.toLoad=0,this.loaded=0,this.isLoaded=!1,this.list={}}load(e){const t=["png"],s=["json"],i=["toml"];return this.toLoad=e.length,new Promise((h=>{e.forEach((e=>{const n=e.split(".").pop()||"";t.includes(n)?this.loadImage(e,h):s.includes(n)?this.loadJson(e,h):i.includes(n)&&this.loadConfig(e,h)}))}))}loadHandler(e){this.loaded+=1,this.loaded===this.toLoad&&(this.loaded=0,this.toLoad=0,e(this),this.isLoaded=!0)}loadImage(e,t){const s=new Image;s.src=e,s.addEventListener("load",(()=>{this.loadHandler(t)}),!1);const i=e.split("/").pop().split(".")[0];i&&(this.list[i]=s)}async loadConfig(e,t){fetch(e).then((e=>e.text())).then((t=>{const s=t.split("\n").reduce(((e,t)=>{const[s,i]=t.trim().split("=");return s&&i?(e[s.trim()]=i.trim(),e):e}),{}),i=e.split("/").pop().split(".")[0];i&&(this.list[i]=s)}))}async loadJson(e,t){try{const s=await fetch(e),i=await s.json();this.loadHandler(t);const h=e.split("/").pop().split(".")[0];this.list[h]=i}catch(e){}}}class t{constructor(e){this.keys={},console.log("Controller created"),window.addEventListener("keydown",(t=>this.handleKeyDown(t,e))),window.addEventListener("keyup",(t=>this.handleKeyUp(t,e)))}handleKeyDown(e,t){switch(this.keys[e.code]=!0,e.code){case"KeyW":e.preventDefault(),t.vel.y=-1;break;case"KeyS":e.preventDefault(),t.vel.y=1;break;case"KeyA":t.vel.x=-1,e.preventDefault();break;case"KeyD":t.vel.x=1,e.preventDefault();break;case"Space":e.preventDefault(),t.fire();break;default:e.preventDefault()}console.log(this.keys)}handleKeyUp(e,t){this.keys[e.code]=!1,delete this.keys[e.code],this.keys.KeyW||this.keys.KeyS||this.keys.KeyA||this.keys.KeyD||(console.log(this.keys),t.vel.reset())}}class s{error(e){console.error(e)}warn(e){console.warn(e)}info(e){console.info("ℹ️ "+e)}debug(e){console.log("📝 "+e)}}class i{constructor(e,t){this.x=e,this.y=t}add(e){return this.x+=e.x,this.y+=e.y,this}sub(e){return this.x-=e.x,this.y-=e.y,this}mul(e){return this.x*=e.x,this.y*=e.y,this}div(e){return this.x/=e.x,this.y/=e.y,this}clone(){return new i(this.x,this.y)}reset(){return this.x=0,this.y=0,this}}class h{constructor(){this.pos=new i(0,0),this.globalPos=new i(0,0),this.vel=new i(0,0),this.size=new i(8,8),this.rotation=0,this.speed=1,this.children=[],this.parent=null}addChild(e){this.children.includes(e)||(e.parent&&e.parent.removeChild(e),e.parent=this,this.children.push(e))}removeChild(e){e.parent=null,this.children=this.children.filter((t=>t!==e))}update(e){this.children.forEach((t=>{t.update(e)}))}render(e){this.children.forEach((t=>{t.render(e)}))}}class n{constructor(){this.health=100,this.exp=0,this.level=1,this.damage=10,this.speed=1,this.defense=1}}const a={basic:{damage:10,speed:5,color:"red"}};var o,r;!function(e){e.Basic="basic"}(o||(o={}));class l extends h{constructor(e,t,s){super(),this.pos=e,this.vel=t,this.type=s}update(e){this.pos.add(this.vel.clone().mul(new i(a[this.type].speed,a[this.type].speed)))}render(e){e.ctx.fillStyle=a[this.type].color,e.ctx.fillRect(this.pos.x,this.pos.y,2,2)}}class d extends h{constructor(){super(),this.stats=new n,this.bullets=[]}fire(){const e=new i(this.pos.x,this.pos.y+16),t=new i(this.pos.x+14,this.pos.y+16),s=new l(e,new i(0,-1),o.Basic);this.bullets.push(s);const h=new l(t,new i(0,-1),o.Basic);this.bullets.push(h),console.log(this.bullets)}update(e){this.pos.add(this.vel),this.bullets.forEach((t=>{t.update(e)}))}render(e){e.drawSprite(0,24,16,16,this.pos.x,this.pos.y,16,16),this.bullets.forEach((t=>{t.render(e)})),this.bullets=this.bullets.filter((t=>{return s=t,i=e.canvas.width,h=e.canvas.height,!(s.pos.x<0||s.pos.x>i||s.pos.y<0||s.pos.y>h);var s,i,h}))}}class c{constructor(){this.logger=new s,this.image=new Image,this.windowSize={width:256,height:240},this.canvas=document.createElement("canvas"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,this.ctx.scale(this.canvas.width/this.windowSize.width,this.canvas.height/this.windowSize.height),document.querySelector("#main").append(this.canvas),this.logger.info("Renderer initialized"),window.addEventListener("resize",(()=>this.resize()))}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.ctx.scale(this.canvas.width/this.windowSize.width,this.canvas.height/this.windowSize.height),this.ctx.imageSmoothingEnabled=!1}drawSprite(e,t,s,i,h,n,a,o){this.ctx.drawImage(this.image,e,t,s,i,h,n,a,o)}drawText(e,t,s){e.split("").forEach(((e,i)=>{this.ctx.drawImage(t,s[e].x,s[e].y,s[e].w,s[e].h,8*i,0,8,8)}))}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}!function(e){e[e.MENU=0]="MENU",e[e.PLAYING=1]="PLAYING",e[e.PAUSED=2]="PAUSED",e[e.GAME_OVER=3]="GAME_OVER",e[e.OPTIONS=4]="OPTIONS",e[e.LOADING=5]="LOADING",e[e.FLYING=6]="FLYING",e[e.DISEMBARK=7]="DISEMBARK"}(r||(r={}));(new class{constructor(){this.renderer=new c,this.assetLoader=new e,this.lastTime=0,this.logger=new s,this.logger.info("Game started"),this.player=new d,this.controller=new t(this.player),window.game=this}update(e){const t=e-this.lastTime;this.lastTime=e,this.player.update(t)}render(){this.renderer.clear(),this.player.render(this.renderer)}run(){this.logger.info("Game running"),this.assetLoader.load(["assets/spritesheet.png","assets/spritesheet_map.json"]).then((()=>{this.logger.info("Assets loaded"),this.renderer.image=this.assetLoader.list.spritesheet,this.loop()}))}loop(){this.update(performance.now()),this.render(),requestAnimationFrame((()=>this.loop()))}}).run()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cGFjazovL3NwYWNlc2hvb3RlcmdhaWRlbi8uL3NyYy9jb250cm9sbGVyLnRzIiwid2VicGFjazovL3NwYWNlc2hvb3RlcmdhaWRlbi8uL3NyYy9sb2dnZXIudHMiLCJ3ZWJwYWNrOi8vc3BhY2VzaG9vdGVyZ2FpZGVuLy4vc3JjL3ZlY3RvcjIudHMiLCJ3ZWJwYWNrOi8vc3BhY2VzaG9vdGVyZ2FpZGVuLy4vc3JjL2dhbWVvYmplY3QudHMiLCJ3ZWJwYWNrOi8vc3BhY2VzaG9vdGVyZ2FpZGVuLy4vc3JjL3BsYXllci50cyIsIndlYnBhY2s6Ly9zcGFjZXNob290ZXJnYWlkZW4vLi9zcmMvZ2FtZS50cyIsIndlYnBhY2s6Ly9zcGFjZXNob290ZXJnYWlkZW4vLi9zcmMvdXRpbHMudHMiLCJ3ZWJwYWNrOi8vc3BhY2VzaG9vdGVyZ2FpZGVuLy4vc3JjL3JlbmRlcmVyLnRzIiwid2VicGFjazovL3NwYWNlc2hvb3RlcmdhaWRlbi8uL3NyYy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvL0B0cy1ub2NoZWNrXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBc3NldExvYWRlciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMudG9Mb2FkID0gMDtcbiAgICAgICAgdGhpcy5sb2FkZWQgPSAwO1xuICAgICAgICB0aGlzLmlzTG9hZGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMubGlzdCA9IHt9O1xuICAgIH1cbiAgICBsb2FkKGFzc2V0cykge1xuICAgICAgICBjb25zdCBpbWFnZUV4dCA9IFtcInBuZ1wiXTtcbiAgICAgICAgY29uc3QganNvbkV4dCA9IFtcImpzb25cIl07XG4gICAgICAgIGNvbnN0IGNvbmZpZ0V4dCA9IFtcInRvbWxcIl07XG4gICAgICAgIHRoaXMudG9Mb2FkID0gYXNzZXRzLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgICAgICBhc3NldHMuZm9yRWFjaCgoYXNzZXQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBleHRlbnNpb24gPSBhc3NldC5zcGxpdChcIi5cIikucG9wKCkgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICBpZiAoaW1hZ2VFeHQuaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRJbWFnZShhc3NldCwgcmVzb2x2ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGpzb25FeHQuaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRKc29uKGFzc2V0LCByZXNvbHZlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY29uZmlnRXh0LmluY2x1ZGVzKGV4dGVuc2lvbikpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkQ29uZmlnKGFzc2V0LCByZXNvbHZlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGxvYWRIYW5kbGVyKHJlc29sdmUpIHtcbiAgICAgICAgdGhpcy5sb2FkZWQgKz0gMTtcbiAgICAgICAgaWYgKHRoaXMubG9hZGVkID09PSB0aGlzLnRvTG9hZCkge1xuICAgICAgICAgICAgdGhpcy5sb2FkZWQgPSAwO1xuICAgICAgICAgICAgdGhpcy50b0xvYWQgPSAwO1xuICAgICAgICAgICAgcmVzb2x2ZSh0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuaXNMb2FkZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGxvYWRJbWFnZShzcmMsIHJlc29sdmUpIHtcbiAgICAgICAgY29uc3QgaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgaW1hZ2Uuc3JjID0gc3JjO1xuICAgICAgICBpbWFnZS5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxvYWRIYW5kbGVyKHJlc29sdmUpO1xuICAgICAgICB9LCBmYWxzZSk7XG4gICAgICAgIGNvbnN0IG5hbWUgPSBzcmMuc3BsaXQoXCIvXCIpLnBvcCgpLnNwbGl0KFwiLlwiKVswXTtcbiAgICAgICAgaWYgKG5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMubGlzdFtuYW1lXSA9IGltYWdlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIGxvYWRDb25maWcoc3JjLCByZXNvbHZlKSB7XG4gICAgICAgIGZldGNoKHNyYylcbiAgICAgICAgICAgIC50aGVuKChkYXRhKSA9PiBkYXRhLnRleHQoKSlcbiAgICAgICAgICAgIC50aGVuKCh0ZXh0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb25maWcgPSB0ZXh0LnNwbGl0KFwiXFxuXCIpLnJlZHVjZSgob2JqLCBzdHIpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBba2V5LCB2YWx1ZV0gPSBzdHIudHJpbSgpLnNwbGl0KFwiPVwiKTtcbiAgICAgICAgICAgICAgICBpZiAoIWtleSB8fCAhdmFsdWUpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgICAgICAgICAgb2JqW2tleS50cmltKCldID0gdmFsdWUudHJpbSgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgICAgICB9LCB7fSk7XG4gICAgICAgICAgICBjb25zdCBuYW1lID0gc3JjLnNwbGl0KFwiL1wiKS5wb3AoKS5zcGxpdChcIi5cIilbMF07XG4gICAgICAgICAgICBpZiAobmFtZSkge1xuICAgICAgICAgICAgICAgIHRoaXMubGlzdFtuYW1lXSA9IGNvbmZpZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGFzeW5jIGxvYWRKc29uKHNyYywgcmVzb2x2ZSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChzcmMpO1xuICAgICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIHRoaXMubG9hZEhhbmRsZXIocmVzb2x2ZSk7XG4gICAgICAgICAgICBjb25zdCBuYW1lID0gc3JjLnNwbGl0KFwiL1wiKS5wb3AoKS5zcGxpdChcIi5cIilbMF07XG4gICAgICAgICAgICB0aGlzLmxpc3RbbmFtZV0gPSBkYXRhO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikgeyB9XG4gICAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29udHJvbGxlciB7XG4gICAgY29uc3RydWN0b3IocGxheWVyKSB7XG4gICAgICAgIHRoaXMua2V5cyA9IHt9O1xuICAgICAgICBjb25zb2xlLmxvZyhcIkNvbnRyb2xsZXIgY3JlYXRlZFwiKTtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlKSA9PiB0aGlzLmhhbmRsZUtleURvd24oZSwgcGxheWVyKSk7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgKGUpID0+IHRoaXMuaGFuZGxlS2V5VXAoZSwgcGxheWVyKSk7XG4gICAgfVxuICAgIGhhbmRsZUtleURvd24oZSwgcGxheWVyKSB7XG4gICAgICAgIHRoaXMua2V5c1tlLmNvZGVdID0gdHJ1ZTtcbiAgICAgICAgc3dpdGNoIChlLmNvZGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJLZXlXXCI6XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIC8vcGxheWVyLm1vdmUoXCJuXCIpO1xuICAgICAgICAgICAgICAgIHBsYXllci52ZWwueSA9IC0xO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIktleVNcIjpcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgcGxheWVyLnZlbC55ID0gMTtcbiAgICAgICAgICAgICAgICAvL3BsYXllci5tb3ZlKFwic1wiKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJLZXlBXCI6XG4gICAgICAgICAgICAgICAgcGxheWVyLnZlbC54ID0gLTE7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIC8vcGxheWVyLm1vdmUoXCJ3XCIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIktleURcIjpcbiAgICAgICAgICAgICAgICBwbGF5ZXIudmVsLnggPSAxO1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAvL3BsYXllci5tb3ZlKFwiZVwiKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJTcGFjZVwiOlxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBwbGF5ZXIuZmlyZSgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2codGhpcy5rZXlzKTtcbiAgICB9XG4gICAgaGFuZGxlS2V5VXAoZSwgcGxheWVyKSB7XG4gICAgICAgIHRoaXMua2V5c1tlLmNvZGVdID0gZmFsc2U7XG4gICAgICAgIGRlbGV0ZSB0aGlzLmtleXNbZS5jb2RlXTtcbiAgICAgICAgaWYgKCF0aGlzLmtleXNbXCJLZXlXXCJdICYmXG4gICAgICAgICAgICAhdGhpcy5rZXlzW1wiS2V5U1wiXSAmJlxuICAgICAgICAgICAgIXRoaXMua2V5c1tcIktleUFcIl0gJiZcbiAgICAgICAgICAgICF0aGlzLmtleXNbXCJLZXlEXCJdKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmtleXMpO1xuICAgICAgICAgICAgcGxheWVyLnZlbC5yZXNldCgpO1xuICAgICAgICB9XG4gICAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgTG9nZ2VyIHtcbiAgICBlcnJvcihtZXNzYWdlKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IobWVzc2FnZSk7XG4gICAgfVxuICAgIHdhcm4obWVzc2FnZSkge1xuICAgICAgICBjb25zb2xlLndhcm4obWVzc2FnZSk7XG4gICAgfVxuICAgIGluZm8obWVzc2FnZSkge1xuICAgICAgICBjb25zb2xlLmluZm8oXCLihLnvuI8gXCIgKyBtZXNzYWdlKTtcbiAgICB9XG4gICAgZGVidWcobWVzc2FnZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIvCfk50gXCIgKyBtZXNzYWdlKTtcbiAgICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBWZWN0b3IyIHtcbiAgICBjb25zdHJ1Y3Rvcih4LCB5KSB7XG4gICAgICAgIHRoaXMueCA9IHg7XG4gICAgICAgIHRoaXMueSA9IHk7XG4gICAgfVxuICAgIGFkZCh2KSB7XG4gICAgICAgIHRoaXMueCArPSB2Lng7XG4gICAgICAgIHRoaXMueSArPSB2Lnk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBzdWIodikge1xuICAgICAgICB0aGlzLnggLT0gdi54O1xuICAgICAgICB0aGlzLnkgLT0gdi55O1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgbXVsKHYpIHtcbiAgICAgICAgdGhpcy54ICo9IHYueDtcbiAgICAgICAgdGhpcy55ICo9IHYueTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIGRpdih2KSB7XG4gICAgICAgIHRoaXMueCAvPSB2Lng7XG4gICAgICAgIHRoaXMueSAvPSB2Lnk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBjbG9uZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKHRoaXMueCwgdGhpcy55KTtcbiAgICB9XG4gICAgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMueCA9IDA7XG4gICAgICAgIHRoaXMueSA9IDA7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbn1cbiIsImltcG9ydCBWZWN0b3IyIGZyb20gXCIuL3ZlY3RvcjJcIjtcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbWVPYmplY3Qge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnBvcyA9IG5ldyBWZWN0b3IyKDAsIDApO1xuICAgICAgICB0aGlzLmdsb2JhbFBvcyA9IG5ldyBWZWN0b3IyKDAsIDApO1xuICAgICAgICB0aGlzLnZlbCA9IG5ldyBWZWN0b3IyKDAsIDApO1xuICAgICAgICB0aGlzLnNpemUgPSBuZXcgVmVjdG9yMig4LCA4KTtcbiAgICAgICAgdGhpcy5yb3RhdGlvbiA9IDA7XG4gICAgICAgIHRoaXMuc3BlZWQgPSAxO1xuICAgICAgICB0aGlzLmNoaWxkcmVuID0gW107XG4gICAgICAgIHRoaXMucGFyZW50ID0gbnVsbDtcbiAgICB9XG4gICAgYWRkQ2hpbGQoY2hpbGQpIHtcbiAgICAgICAgaWYgKHRoaXMuY2hpbGRyZW4uaW5jbHVkZXMoY2hpbGQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoaWxkLnBhcmVudCkge1xuICAgICAgICAgICAgY2hpbGQucGFyZW50LnJlbW92ZUNoaWxkKGNoaWxkKTtcbiAgICAgICAgfVxuICAgICAgICBjaGlsZC5wYXJlbnQgPSB0aGlzO1xuICAgICAgICB0aGlzLmNoaWxkcmVuLnB1c2goY2hpbGQpO1xuICAgIH1cbiAgICByZW1vdmVDaGlsZChjaGlsZCkge1xuICAgICAgICBjaGlsZC5wYXJlbnQgPSBudWxsO1xuICAgICAgICB0aGlzLmNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbi5maWx0ZXIoKGMpID0+IGMgIT09IGNoaWxkKTtcbiAgICB9XG4gICAgdXBkYXRlKGR0KSB7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQpID0+IHtcbiAgICAgICAgICAgIGNoaWxkLnVwZGF0ZShkdCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZW5kZXIocmVuZGVyZXIpIHtcbiAgICAgICAgdGhpcy5jaGlsZHJlbi5mb3JFYWNoKChjaGlsZCkgPT4ge1xuICAgICAgICAgICAgY2hpbGQucmVuZGVyKHJlbmRlcmVyKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIFN0YXRzIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5oZWFsdGggPSAxMDA7XG4gICAgICAgIHRoaXMuZXhwID0gMDtcbiAgICAgICAgdGhpcy5sZXZlbCA9IDE7XG4gICAgICAgIHRoaXMuZGFtYWdlID0gMTA7XG4gICAgICAgIHRoaXMuc3BlZWQgPSAxO1xuICAgICAgICB0aGlzLmRlZmVuc2UgPSAxO1xuICAgIH1cbn1cbiIsImltcG9ydCBHYW1lT2JqZWN0LCB7IFN0YXRzIH0gZnJvbSBcIi4vZ2FtZW9iamVjdFwiO1xuaW1wb3J0IHsgaXNPdXRPZlNjcmVlbiB9IGZyb20gXCIuL3V0aWxzXCI7XG5pbXBvcnQgVmVjdG9yMiBmcm9tIFwiLi92ZWN0b3IyXCI7XG5jb25zdCB3ZWFwb25UeXBlcyA9IHtcbiAgICBiYXNpYzoge1xuICAgICAgICBkYW1hZ2U6IDEwLFxuICAgICAgICBzcGVlZDogNSxcbiAgICAgICAgY29sb3I6IFwicmVkXCIsXG4gICAgfSxcbn07XG52YXIgV2VhcG9uVHlwZTtcbihmdW5jdGlvbiAoV2VhcG9uVHlwZSkge1xuICAgIFdlYXBvblR5cGVbXCJCYXNpY1wiXSA9IFwiYmFzaWNcIjtcbn0pKFdlYXBvblR5cGUgfHwgKFdlYXBvblR5cGUgPSB7fSkpO1xuZXhwb3J0IGNsYXNzIEJ1bGxldCBleHRlbmRzIEdhbWVPYmplY3Qge1xuICAgIGNvbnN0cnVjdG9yKHBvcywgdmVsLCB0eXBlKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMucG9zID0gcG9zO1xuICAgICAgICB0aGlzLnZlbCA9IHZlbDtcbiAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICB9XG4gICAgdXBkYXRlKGR0KSB7XG4gICAgICAgIHRoaXMucG9zLmFkZCh0aGlzLnZlbFxuICAgICAgICAgICAgLmNsb25lKClcbiAgICAgICAgICAgIC5tdWwobmV3IFZlY3RvcjIod2VhcG9uVHlwZXNbdGhpcy50eXBlXS5zcGVlZCwgd2VhcG9uVHlwZXNbdGhpcy50eXBlXS5zcGVlZCkpKTtcbiAgICB9XG4gICAgcmVuZGVyKHJlbmRlcmVyKSB7XG4gICAgICAgIHJlbmRlcmVyLmN0eC5maWxsU3R5bGUgPSB3ZWFwb25UeXBlc1t0aGlzLnR5cGVdLmNvbG9yO1xuICAgICAgICByZW5kZXJlci5jdHguZmlsbFJlY3QodGhpcy5wb3MueCwgdGhpcy5wb3MueSwgMiwgMik7XG4gICAgfVxufVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGxheWVyIGV4dGVuZHMgR2FtZU9iamVjdCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuc3RhdHMgPSBuZXcgU3RhdHMoKTtcbiAgICAgICAgdGhpcy5idWxsZXRzID0gW107XG4gICAgfVxuICAgIGZpcmUoKSB7XG4gICAgICAgIGNvbnN0IGxlZnRHdW5Qb3MgPSBuZXcgVmVjdG9yMih0aGlzLnBvcy54LCB0aGlzLnBvcy55ICsgMTYpO1xuICAgICAgICBjb25zdCByaWdodEd1blBvcyA9IG5ldyBWZWN0b3IyKHRoaXMucG9zLnggKyAxNCwgdGhpcy5wb3MueSArIDE2KTtcbiAgICAgICAgY29uc3QgbGVmdEJ1bGxldCA9IG5ldyBCdWxsZXQobGVmdEd1blBvcywgbmV3IFZlY3RvcjIoMCwgLTEpLCBXZWFwb25UeXBlLkJhc2ljKTtcbiAgICAgICAgdGhpcy5idWxsZXRzLnB1c2gobGVmdEJ1bGxldCk7XG4gICAgICAgIGNvbnN0IGJ1bGxldCA9IG5ldyBCdWxsZXQocmlnaHRHdW5Qb3MsIG5ldyBWZWN0b3IyKDAsIC0xKSwgV2VhcG9uVHlwZS5CYXNpYyk7XG4gICAgICAgIHRoaXMuYnVsbGV0cy5wdXNoKGJ1bGxldCk7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuYnVsbGV0cyk7XG4gICAgfVxuICAgIHVwZGF0ZShkdCkge1xuICAgICAgICB0aGlzLnBvcy5hZGQodGhpcy52ZWwpO1xuICAgICAgICB0aGlzLmJ1bGxldHMuZm9yRWFjaCgoYnVsbGV0KSA9PiB7XG4gICAgICAgICAgICBidWxsZXQudXBkYXRlKGR0KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJlbmRlcihyZW5kZXJlcikge1xuICAgICAgICByZW5kZXJlci5kcmF3U3ByaXRlKDAsIDI0LCAxNiwgMTYsIHRoaXMucG9zLngsIHRoaXMucG9zLnksIDE2LCAxNik7XG4gICAgICAgIHRoaXMuYnVsbGV0cy5mb3JFYWNoKChidWxsZXQpID0+IHtcbiAgICAgICAgICAgIGJ1bGxldC5yZW5kZXIocmVuZGVyZXIpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5idWxsZXRzID0gdGhpcy5idWxsZXRzLmZpbHRlcigoYnVsbGV0KSA9PiAhaXNPdXRPZlNjcmVlbihidWxsZXQsIHJlbmRlcmVyLmNhbnZhcy53aWR0aCwgcmVuZGVyZXIuY2FudmFzLmhlaWdodCkpO1xuICAgIH1cbn1cbiIsImltcG9ydCBBc3NldExvYWRlciBmcm9tIFwiLi9hc3NldGxvYWRlclwiO1xuaW1wb3J0IENvbnRyb2xsZXIgZnJvbSBcIi4vY29udHJvbGxlclwiO1xuaW1wb3J0IExvZ2dlciBmcm9tIFwiLi9sb2dnZXJcIjtcbmltcG9ydCBQbGF5ZXIgZnJvbSBcIi4vcGxheWVyXCI7XG5pbXBvcnQgUmVuZGVyZXIgZnJvbSBcIi4vcmVuZGVyZXJcIjtcbnZhciBHYW1lU3RhdGU7XG4oZnVuY3Rpb24gKEdhbWVTdGF0ZSkge1xuICAgIEdhbWVTdGF0ZVtHYW1lU3RhdGVbXCJNRU5VXCJdID0gMF0gPSBcIk1FTlVcIjtcbiAgICBHYW1lU3RhdGVbR2FtZVN0YXRlW1wiUExBWUlOR1wiXSA9IDFdID0gXCJQTEFZSU5HXCI7XG4gICAgR2FtZVN0YXRlW0dhbWVTdGF0ZVtcIlBBVVNFRFwiXSA9IDJdID0gXCJQQVVTRURcIjtcbiAgICBHYW1lU3RhdGVbR2FtZVN0YXRlW1wiR0FNRV9PVkVSXCJdID0gM10gPSBcIkdBTUVfT1ZFUlwiO1xuICAgIEdhbWVTdGF0ZVtHYW1lU3RhdGVbXCJPUFRJT05TXCJdID0gNF0gPSBcIk9QVElPTlNcIjtcbiAgICBHYW1lU3RhdGVbR2FtZVN0YXRlW1wiTE9BRElOR1wiXSA9IDVdID0gXCJMT0FESU5HXCI7XG4gICAgR2FtZVN0YXRlW0dhbWVTdGF0ZVtcIkZMWUlOR1wiXSA9IDZdID0gXCJGTFlJTkdcIjtcbiAgICBHYW1lU3RhdGVbR2FtZVN0YXRlW1wiRElTRU1CQVJLXCJdID0gN10gPSBcIkRJU0VNQkFSS1wiO1xufSkoR2FtZVN0YXRlIHx8IChHYW1lU3RhdGUgPSB7fSkpO1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2FtZSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIgPSBuZXcgUmVuZGVyZXIoKTtcbiAgICAgICAgdGhpcy5hc3NldExvYWRlciA9IG5ldyBBc3NldExvYWRlcigpO1xuICAgICAgICB0aGlzLmxhc3RUaW1lID0gMDtcbiAgICAgICAgdGhpcy5sb2dnZXIgPSBuZXcgTG9nZ2VyKCk7XG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm8oXCJHYW1lIHN0YXJ0ZWRcIik7XG4gICAgICAgIHRoaXMucGxheWVyID0gbmV3IFBsYXllcigpO1xuICAgICAgICB0aGlzLmNvbnRyb2xsZXIgPSBuZXcgQ29udHJvbGxlcih0aGlzLnBsYXllcik7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgd2luZG93W1wiZ2FtZVwiXSA9IHRoaXM7XG4gICAgfVxuICAgIHVwZGF0ZSh0cykge1xuICAgICAgICBjb25zdCBkdCA9IHRzIC0gdGhpcy5sYXN0VGltZTtcbiAgICAgICAgdGhpcy5sYXN0VGltZSA9IHRzO1xuICAgICAgICB0aGlzLnBsYXllci51cGRhdGUoZHQpO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuY2xlYXIoKTtcbiAgICAgICAgLy90aGlzLnJlbmRlcmVyLmRyYXdUZXh0KFxuICAgICAgICAvLyAgXCJTUEFDRSBTSE9PVEVSIEdBSURFTiBWMC4xXCIsXG4gICAgICAgIC8vICB0aGlzLmFzc2V0TG9hZGVyLmxpc3RbXCJzcHJpdGVzaGVldFwiXSBhcyBIVE1MSW1hZ2VFbGVtZW50LFxuICAgICAgICAvLyAgdGhpcy5hc3NldExvYWRlci5saXN0W1wic3ByaXRlc2hlZXRfbWFwXCJdXG4gICAgICAgIC8vKTtcbiAgICAgICAgdGhpcy5wbGF5ZXIucmVuZGVyKHRoaXMucmVuZGVyZXIpO1xuICAgIH1cbiAgICBydW4oKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm8oXCJHYW1lIHJ1bm5pbmdcIik7XG4gICAgICAgIHRoaXMuYXNzZXRMb2FkZXJcbiAgICAgICAgICAgIC5sb2FkKFtcImFzc2V0cy9zcHJpdGVzaGVldC5wbmdcIiwgXCJhc3NldHMvc3ByaXRlc2hlZXRfbWFwLmpzb25cIl0pXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKFwiQXNzZXRzIGxvYWRlZFwiKTtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuaW1hZ2UgPSB0aGlzLmFzc2V0TG9hZGVyLmxpc3RbXCJzcHJpdGVzaGVldFwiXTtcbiAgICAgICAgICAgIHRoaXMubG9vcCgpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgbG9vcCgpIHtcbiAgICAgICAgdGhpcy51cGRhdGUocGVyZm9ybWFuY2Uubm93KCkpO1xuICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5sb29wKCkpO1xuICAgIH1cbn1cbiIsImV4cG9ydCBmdW5jdGlvbiBpc0NvbGxpZGUoYSwgYikge1xuICAgIHJldHVybiAoYS5wb3MueCA8IGIucG9zLnggKyBiLnNpemUueCAmJlxuICAgICAgICBhLnBvcy54ICsgYS5zaXplLnggPiBiLnBvcy54ICYmXG4gICAgICAgIGEucG9zLnkgPCBiLnBvcy55ICsgYi5zaXplLnkgJiZcbiAgICAgICAgYS5wb3MueSArIGEuc2l6ZS55ID4gYi5wb3MueSk7XG59XG5leHBvcnQgZnVuY3Rpb24gaXNPdXRPZlNjcmVlbihvYmosIHdpZHRoLCBoZWlnaHQpIHtcbiAgICByZXR1cm4gKG9iai5wb3MueCA8IDAgfHxcbiAgICAgICAgb2JqLnBvcy54ID4gd2lkdGggfHxcbiAgICAgICAgb2JqLnBvcy55IDwgMCB8fFxuICAgICAgICBvYmoucG9zLnkgPiBoZWlnaHQpO1xufVxuIiwiaW1wb3J0IExvZ2dlciBmcm9tIFwiLi9sb2dnZXJcIjtcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJlbmRlcmVyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5sb2dnZXIgPSBuZXcgTG9nZ2VyKCk7XG4gICAgICAgIHRoaXMuaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgdGhpcy53aW5kb3dTaXplID0ge1xuICAgICAgICAgICAgd2lkdGg6IDI1NixcbiAgICAgICAgICAgIGhlaWdodDogMjQwLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgICAgIHRoaXMuY2FudmFzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG4gICAgICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbiAgICAgICAgdGhpcy5jdHggPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICAgIHRoaXMuY3R4LmltYWdlU21vb3RoaW5nRW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmN0eC5zY2FsZSh0aGlzLmNhbnZhcy53aWR0aCAvIHRoaXMud2luZG93U2l6ZS53aWR0aCwgdGhpcy5jYW52YXMuaGVpZ2h0IC8gdGhpcy53aW5kb3dTaXplLmhlaWdodCk7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbWFpblwiKS5hcHBlbmQodGhpcy5jYW52YXMpO1xuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKFwiUmVuZGVyZXIgaW5pdGlhbGl6ZWRcIik7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicmVzaXplXCIsICgpID0+IHRoaXMucmVzaXplKCkpO1xuICAgIH1cbiAgICByZXNpemUoKSB7XG4gICAgICAgIHRoaXMuY2FudmFzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG4gICAgICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbiAgICAgICAgdGhpcy5jdHguc2NhbGUodGhpcy5jYW52YXMud2lkdGggLyB0aGlzLndpbmRvd1NpemUud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCAvIHRoaXMud2luZG93U2l6ZS5oZWlnaHQpO1xuICAgICAgICB0aGlzLmN0eC5pbWFnZVNtb290aGluZ0VuYWJsZWQgPSBmYWxzZTtcbiAgICB9XG4gICAgZHJhd1Nwcml0ZSh0aWxlWCwgdGlsZVksIHcsIGgsIHgsIHksIHNpemVYLCBzaXplWSkge1xuICAgICAgICB0aGlzLmN0eC5kcmF3SW1hZ2UodGhpcy5pbWFnZSwgdGlsZVgsIHRpbGVZLCB3LCBoLCB4LCB5LCBzaXplWCwgc2l6ZVkpO1xuICAgIH1cbiAgICBkcmF3VGV4dCh0ZXh0LCBzcHJpdGVTaGVldCwgc3ByaXRlU2hlZXRNYXApIHtcbiAgICAgICAgdGV4dC5zcGxpdChcIlwiKS5mb3JFYWNoKChjaGFyLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jdHguZHJhd0ltYWdlKHNwcml0ZVNoZWV0LCBzcHJpdGVTaGVldE1hcFtjaGFyXS54LCBzcHJpdGVTaGVldE1hcFtjaGFyXS55LCBzcHJpdGVTaGVldE1hcFtjaGFyXS53LCBzcHJpdGVTaGVldE1hcFtjaGFyXS5oLCBpbmRleCAqIDgsIDAsIDgsIDgpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgY2xlYXIoKSB7XG4gICAgICAgIHRoaXMuY3R4LmNsZWFyUmVjdCgwLCAwLCB0aGlzLmNhbnZhcy53aWR0aCwgdGhpcy5jYW52YXMuaGVpZ2h0KTtcbiAgICB9XG59XG4iLCJpbXBvcnQgR2FtZSBmcm9tIFwiLi9nYW1lXCI7XG5jb25zdCBnYW1lID0gbmV3IEdhbWUoKTtcbmdhbWUucnVuKCk7XG4iXSwibmFtZXMiOlsiQXNzZXRMb2FkZXIiLCJjb25zdHJ1Y3RvciIsInRoaXMiLCJ0b0xvYWQiLCJsb2FkZWQiLCJpc0xvYWRlZCIsImxpc3QiLCJsb2FkIiwiYXNzZXRzIiwiaW1hZ2VFeHQiLCJqc29uRXh0IiwiY29uZmlnRXh0IiwibGVuZ3RoIiwiUHJvbWlzZSIsInJlc29sdmUiLCJmb3JFYWNoIiwiYXNzZXQiLCJleHRlbnNpb24iLCJzcGxpdCIsInBvcCIsImluY2x1ZGVzIiwibG9hZEltYWdlIiwibG9hZEpzb24iLCJsb2FkQ29uZmlnIiwibG9hZEhhbmRsZXIiLCJzcmMiLCJpbWFnZSIsIkltYWdlIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm5hbWUiLCJhc3luYyIsImZldGNoIiwidGhlbiIsImRhdGEiLCJ0ZXh0IiwiY29uZmlnIiwicmVkdWNlIiwib2JqIiwic3RyIiwia2V5IiwidmFsdWUiLCJ0cmltIiwicmVzcG9uc2UiLCJqc29uIiwiZXJyb3IiLCJDb250cm9sbGVyIiwicGxheWVyIiwia2V5cyIsImNvbnNvbGUiLCJsb2ciLCJ3aW5kb3ciLCJlIiwiaGFuZGxlS2V5RG93biIsImhhbmRsZUtleVVwIiwiY29kZSIsInByZXZlbnREZWZhdWx0IiwidmVsIiwieSIsIngiLCJmaXJlIiwicmVzZXQiLCJMb2dnZXIiLCJtZXNzYWdlIiwid2FybiIsImluZm8iLCJkZWJ1ZyIsIlZlY3RvcjIiLCJhZGQiLCJ2Iiwic3ViIiwibXVsIiwiZGl2IiwiY2xvbmUiLCJHYW1lT2JqZWN0IiwicG9zIiwiZ2xvYmFsUG9zIiwic2l6ZSIsInJvdGF0aW9uIiwic3BlZWQiLCJjaGlsZHJlbiIsInBhcmVudCIsImFkZENoaWxkIiwiY2hpbGQiLCJyZW1vdmVDaGlsZCIsInB1c2giLCJmaWx0ZXIiLCJjIiwidXBkYXRlIiwiZHQiLCJyZW5kZXIiLCJyZW5kZXJlciIsIlN0YXRzIiwiaGVhbHRoIiwiZXhwIiwibGV2ZWwiLCJkYW1hZ2UiLCJkZWZlbnNlIiwid2VhcG9uVHlwZXMiLCJiYXNpYyIsImNvbG9yIiwiV2VhcG9uVHlwZSIsIkdhbWVTdGF0ZSIsIkJ1bGxldCIsInR5cGUiLCJzdXBlciIsImN0eCIsImZpbGxTdHlsZSIsImZpbGxSZWN0IiwiUGxheWVyIiwic3RhdHMiLCJidWxsZXRzIiwibGVmdEd1blBvcyIsInJpZ2h0R3VuUG9zIiwibGVmdEJ1bGxldCIsIkJhc2ljIiwiYnVsbGV0IiwiZHJhd1Nwcml0ZSIsIndpZHRoIiwiY2FudmFzIiwiaGVpZ2h0IiwiUmVuZGVyZXIiLCJsb2dnZXIiLCJ3aW5kb3dTaXplIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJXaWR0aCIsImlubmVySGVpZ2h0IiwiZ2V0Q29udGV4dCIsImltYWdlU21vb3RoaW5nRW5hYmxlZCIsInNjYWxlIiwicXVlcnlTZWxlY3RvciIsImFwcGVuZCIsInJlc2l6ZSIsInRpbGVYIiwidGlsZVkiLCJ3IiwiaCIsInNpemVYIiwic2l6ZVkiLCJkcmF3SW1hZ2UiLCJkcmF3VGV4dCIsInNwcml0ZVNoZWV0Iiwic3ByaXRlU2hlZXRNYXAiLCJjaGFyIiwiaW5kZXgiLCJjbGVhciIsImNsZWFyUmVjdCIsImFzc2V0TG9hZGVyIiwibGFzdFRpbWUiLCJjb250cm9sbGVyIiwidHMiLCJydW4iLCJsb29wIiwicGVyZm9ybWFuY2UiLCJub3ciLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiXSwic291cmNlUm9vdCI6IiJ9